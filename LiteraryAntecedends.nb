(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    145579,       3783]
NotebookOptionsPosition[    122017,       3231]
NotebookOutlinePosition[    140161,       3626]
CellTagsIndexPosition[    140118,       3623]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Formatting", "Title"],

Cell[CellGroupData[{

Cell[TextData[{
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " Document Formatting"
}], "Section"],

Cell[CellGroupData[{

Cell["FindCellChangeTimes", "Subsection"],

Cell["Checks this document for any cells that track change times. ", \
"Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindCellChangeTimes", "[", "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Cases", "[", 
    RowBox[{
     RowBox[{"NotebookGet", "[", 
      RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
     RowBox[{
      RowBox[{"Cell", "[", 
       RowBox[{"content_", ",", "cellType_String", ",", "optA___", ",", 
        RowBox[{"CellChangeTimes", "\[Rule]", "_"}], ",", "optB___"}], "]"}], 
      "\[RuleDelayed]", "cellType"}], ",", "\[Infinity]"}], "]"}], 
   "]"}]}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FindCellChangeTimes", "Subsection"],

Cell["\<\
Finds the names of all symbols with CellContext added to their names\
\>", "Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindCellContext", "[", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "cc", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cc", "=", 
      RowBox[{"\"\<$CellC\>\"", "<>", "\"\<ontext`\>\""}]}], ";", 
     RowBox[{"Union", "[", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"NotebookGet", "[", 
         RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
        RowBox[{"x_Symbol", "/;", 
         RowBox[{"StringMatchQ", "[", 
          RowBox[{
           RowBox[{"ToString", "[", "x", "]"}], ",", 
           RowBox[{"cc", "~~", "___"}]}], "]"}]}], ",", "\[Infinity]"}], 
       "]"}], "]"}]}]}], "]"}]}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell["ClearBuggyFormatting", "Subsection",
 CellDingbat->"!"],

Cell["\<\
Clears the buggy formatting, which includes cells renamed with CellContext \
and CellChangeTimes attributes. \
\>", "Paragraph"],

Cell["\<\
Dangerous\[LongDash]in the future CellContext may be necessary for certain \
cells, so try to run this only once. Also, it needs to be run on itself, too. \
\>", "Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClearBuggyFormatting", "[", "filename_String", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"NotebookSave", "[", 
     RowBox[{"InputNotebook", "[", "]"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"NotebookClose", "[", 
     RowBox[{"InputNotebook", "[", "]"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Run", "[", "\"\<perl removeBuggyFormatting.pl\>\"", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"NotebookOpen", "[", 
     RowBox[{
     "\"\</home/dragonfly/Dropbox/pony physics/\>\"", "<>", "filename"}], 
     "]"}], ";"}], ")"}]}]], "Input"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Dynamic Inline Cells", "Section"],

Cell[CellGroupData[{

Cell["Notes", "Subsection"],

Cell["\<\
There are some cells in this document that dynamically update themselves. \
They need to be able to \
\>", "Paragraph"],

Cell[CellGroupData[{

Cell["Triger an event when clicked or hovered on. ", "Item"],

Cell["Display correctly when the document is loaded. ", "Item"]
}, Open  ]],

Cell["\<\
The first version will just be a tag box and not dynamic. I can\
\[CloseCurlyQuote]t figure out a good way to do it. \
\>", "Paragraph"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Subsection"],

Cell["InsertDynamicInlineCell", "Subsubsection"]
}, Open  ]]
}, Closed]],

Cell["Exporting", "Section"],

Cell[CellGroupData[{

Cell["Word Counts", "Section"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "WordCount", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<CellTypes\>\"", "\[Rule]", 
     RowBox[{
     "\"\<Paragraph\>\"", "|", "\"\<ContinuedParagraph\>\"", "|", 
      "\"\<Quote\>\"", "|", "\"\<BookText\>\"", "|", "\"\<Story\>\"", "|", 
      "\"\<Footnote\>\"", "|", "\"\<Item\>\"", "|", "\"\<LibrettoLyrics\>\"", 
      "|", "\"\<LibrettoDirections\>\""}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.5816381879525614`*^9, 3.581638263044856*^9}, {
  3.5816383841357822`*^9, 3.5816384035378923`*^9}, {3.5816516360717497`*^9, 
  3.581651637786848*^9}, {3.587510776629101*^9, 3.587510831638401*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WordCount", "[", 
   RowBox[{"OptionsPattern", "[", "]"}], "]"}], ":=", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"StringSplit", "[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"First", "[", "#", "]"}], "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"StyleBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"TextData", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Cell", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"ButtonBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}]}], "}"}]}], "&"}], "/@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"NotebookGet", "[", 
         RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
        RowBox[{"Cell", "[", 
         RowBox[{"__", ",", 
          RowBox[{"OptionValue", "[", "\"\<CellTypes\>\"", "]"}], ",", 
          "___"}], "]"}], ",", "\[Infinity]"}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.5299531336408167`*^9, 3.529953138889117*^9}, {
   3.5816384067620764`*^9, 3.5816384102622766`*^9}, 3.5816384598751144`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WordCount", "[", 
   RowBox[{"s_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"StringSplit", "[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"First", "[", "#", "]"}], "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"StyleBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"TextData", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Cell", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"ButtonBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}]}], "}"}]}], "&"}], "/@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"NotebookGet", "[", 
           RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
          RowBox[{"CellGroupData", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Cell", "[", 
               RowBox[{"s", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
            "___"}], "]"}], ",", "\[Infinity]"}], "]"}], ",", 
        RowBox[{"Cell", "[", 
         RowBox[{"__", ",", 
          RowBox[{"OptionValue", "[", "\"\<CellTypes\>\"", "]"}], ",", 
          "___"}], "]"}], ",", "\[Infinity]"}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.5299531475316114`*^9, {3.581638415334567*^9, 3.581638416010606*^9}, 
   3.581638453945775*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WordCount", "[", 
   RowBox[{"s_", ",", "p_List", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"StringSplit", "[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"First", "[", "#", "]"}], "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"StyleBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"TextData", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Cell", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"ButtonBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}]}], "}"}]}], "&"}], "/@", "\[IndentingNewLine]", 
      RowBox[{"Cases", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cases", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"NotebookGet", "[", 
             RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
            RowBox[{"CellGroupData", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Cell", "[", 
                 RowBox[{"s", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
              "___"}], "]"}], ",", "\[Infinity]"}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"CellGroupData", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cell", "[", 
                RowBox[{"q_", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
             "___"}], "]"}], "/;", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"p", ",", "q"}], "]"}]}], ",", "\[Infinity]"}], "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Cell", "[", 
         RowBox[{"__", ",", 
          RowBox[{"OptionValue", "[", "\"\<CellTypes\>\"", "]"}], ",", 
          "___"}], "]"}], ",", "\[Infinity]"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5299531591342745`*^9, 3.529953161900433*^9}, 
   3.5527464433193665`*^9, {3.5527464739920774`*^9, 3.5527464838102036`*^9}, {
   3.581638418396742*^9, 3.5816384474624043`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"WordCount", "[", 
   RowBox[{"s_", ",", "j__", ",", "p_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Total", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"StringSplit", "[", "#", "]"}], "]"}], "&"}], "/@", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"First", "[", "#", "]"}], "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"StyleBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"TextData", "[", "__", "]"}]}], "\[RuleDelayed]", 
           RowBox[{
           "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Cell", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}], ",", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"ButtonBox", "[", "__", "]"}]}], "\[RuleDelayed]", 
           "\"\<a\>\""}]}], "}"}]}], "&"}], "/@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Fold", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{"#", ",", 
               RowBox[{"CellGroupData", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Cell", "[", 
                    RowBox[{"#2", ",", "___"}], "]"}], ",", "___"}], "}"}], 
                 ",", "___"}], "]"}], ",", "\[Infinity]"}], "]"}], "&"}], ",", 
            RowBox[{"Cases", "[", 
             RowBox[{
              RowBox[{"NotebookGet", "[", 
               RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
              RowBox[{"CellGroupData", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Cell", "[", 
                   RowBox[{"s", ",", "___"}], "]"}], ",", "___"}], "}"}], ",",
                 "___"}], "]"}], ",", "\[Infinity]"}], "]"}], ",", 
            RowBox[{"{", "j", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"CellGroupData", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cell", "[", 
                RowBox[{"q_", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
             "___"}], "]"}], "/;", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"p", ",", "q"}], "]"}]}], ",", "\[Infinity]"}], "]"}], 
        ",", 
        RowBox[{"Cell", "[", 
         RowBox[{"__", ",", 
          RowBox[{"OptionValue", "[", "\"\<CellTypes\>\"", "]"}], ",", 
          "___"}], "]"}], ",", "\[Infinity]"}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.552746429248046*^9, 3.5527464365264215`*^9}, {
  3.552746580706519*^9, 3.552746664422269*^9}, {3.552746699664155*^9, 
  3.5527467843997965`*^9}, {3.5816384239200583`*^9, 3.5816384396119556`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Reference Formatting", "Section"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FindSection", "[", "context_String", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{"#", ",", "#2", ",", "\[Infinity]"}], "]"}], "&"}], ",", 
    RowBox[{"NotebookGet", "[", 
     RowBox[{"InputNotebook", "[", "]"}], "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"CellGroupData", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cell", "[", 
           RowBox[{"#", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
        "___"}], "]"}], "&"}], "/@", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", 
       RowBox[{"SectionHeaderName", "[", "context", "]"}], "}"}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.590579755909315*^9, 3.590579763168232*^9}, {
  3.590579818864275*^9, 3.5905798467648015`*^9}, {3.5905799680481358`*^9, 
  3.5905800018724117`*^9}, {3.5905801366564536`*^9, 3.590580192385502*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "FormatReference", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReferenceCounter", "[", 
    RowBox[{"n_", ",", "context_"}], "]"}], ":=", "n"}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FormatReference", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Format\>\"", "\[Rule]", "\"\<Web\>\""}], ",", 
     RowBox[{"\"\<Abbreviation\>\"", "\[Rule]", "None"}]}], "}"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Reference", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Citation\>\"", "\[Rule]", "\"\<Book\>\""}], ",", 
     RowBox[{"\"\<Author\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<Title\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Date\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<Publisher\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Volume\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Number\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Chapter\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Source\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Pages\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<URL\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Footnote\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Location\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Edition\>\"", "\[Rule]", "None"}], ",", 
     RowBox[{"\"\<Editor\>\"", "\[Rule]", "None"}]}], "}"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.5770708315443306`*^9, 3.5770708356638527`*^9}, {
  3.5770709162399225`*^9, 3.577070919879378*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReferenceContextList", "[", "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RegisterReferenceContext", "[", "context_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"MemberQ", "[", 
       RowBox[{
        RowBox[{"ReferenceContextList", "[", "]"}], ",", "context"}], "]"}]}],
      ",", 
     RowBox[{
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"ReferenceContextList", "[", "]"}], ",", "context"}], "]"}], 
      ";"}]}], "]"}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FormatReference", "[", 
   RowBox[{
    RowBox[{"Reference", "[", 
     RowBox[{"OptionsPattern", "[", "]"}], "]"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"title", ",", "url", ",", "book"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Row", "[", 
      RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"MapAt", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Head", "[", "#", "]"}], "===", "String"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"#", "<>", "\"\<,\>\""}], ",", "\[IndentingNewLine]", 
               RowBox[{"Row", "[", 
                RowBox[{"{", 
                 RowBox[{"#", ",", "\"\<,\>\""}], "}"}], "]"}]}], "]"}], 
             "&"}], ",", "\[IndentingNewLine]", "#", ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Array", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", "#", "}"}], "&"}], ",", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Unevaluated", "[", "#", "]"}], "]"}], "-", "1"}]}], 
             "]"}]}], "]"}], "&"}], "[", "\[IndentingNewLine]", 
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", 
             RowBox[{"FormatReference", ",", "\"\<Abbreviation\>\""}], "]"}], 
            "===", "\"\<Ibid\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Reap", "[", 
             RowBox[{
              RowBox[{"Sow", "[", "\"\<Ibid.\>\"", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "=!=", 
                 "None"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Switch", "[", 
                 RowBox[{
                  RowBox[{"Head", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                   ",", "\[IndentingNewLine]", "Integer", ",", 
                  RowBox[{"\"\<pg. \>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", "List", ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pg. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     ">", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pp. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}], "<>", "\"\<-\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                 "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], "=!=",
                  "None"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"\"\<footnote \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], 
                   "]"}]}], "]"}]}], "]"}], ";"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"OptionValue", "[", 
             RowBox[{"FormatReference", ",", "\"\<Abbreviation\>\""}], "]"}], 
            "===", "\"\<Citation\>\""}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Reap", "[", 
             RowBox[{
              RowBox[{"Sow", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"url", ",", 
                   RowBox[{"Hyperlink", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<URL\>\""}], "]"}]}], "]"}],
                    ",", "#"}], "]"}], "&"}], "[", "\[IndentingNewLine]", 
                RowBox[{"StringJoin", "@@", 
                 RowBox[{"Riffle", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Reap", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], "&&", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}], "=!=",
                     "None"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"StringJoin", "@@", 
                    RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], ">", "3"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", "\"\<et al\>\""}], "}"}], 
                    ",", "#"}], "]"}], "&"}], "[", 
                    RowBox[{"Sort", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\< \>\""}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}]}], 
                    "]"}], "]"}], ",", "\"\<, \>\""}], "]"}]}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], "&&", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}], "=!=",
                     "None"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"StringJoin", "@@", 
                    RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], ">", "3"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", "\"\<et al, eds.\>\""}], 
                    "}"}], ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
                    RowBox[{"Append", "[", 
                    RowBox[{"#", ",", "\"\<eds.\>\""}], "]"}], ",", "True", 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", "\"\<ed.\>\""}], "}"}]}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"Sort", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\< \>\""}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}]}], 
                    "]"}], "]"}], ",", "\"\<, \>\""}], "]"}]}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Date\>\""}], "]"}], "=!=", 
                    
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"\"\<Year\>\"", "\[Rule]", "_"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", "\[IndentingNewLine]", 
                    RowBox[{"DateString", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<Year\>\"", "+", "1"}], ",", "0", ",", "0", 
                    ",", "0", ",", "0", ",", "0"}], "}"}], "/.", "#"}], ",", 
                    RowBox[{"{", "\"\<Year\>\"", "}"}]}], "]"}], "]"}]}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Date\>\""}], "]"}], 
                    "]"}]}], "]"}]}], "]"}], "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                   "\"\<, \>\""}], "]"}]}], "]"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "=!=", 
                 "None"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Switch", "[", 
                 RowBox[{
                  RowBox[{"Head", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                   ",", "\[IndentingNewLine]", "Integer", ",", 
                  RowBox[{"\"\<pg. \>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", "List", ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pg. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     ">", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pp. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}], "<>", "\"\<-\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                 "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], "=!=",
                  "None"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"\"\<footnote \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], 
                   "]"}]}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
             "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"OptionValue", "[", 
             RowBox[{"FormatReference", ",", "\"\<Abbreviation\>\""}], "]"}], 
            "===", "None"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Reap", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}], "=!=", 
                  RowBox[{"{", "}"}]}], "&&", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}], "=!=",
                   "None"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"Sow", "[", 
                 RowBox[{"StringJoin", "@@", 
                  RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], ">", "1"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Last", "[", "#", "]"}], "<>", "\"\<, \>\"", "<>", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"First", "[", "#", "]"}], ",", "1"}], "]"}], 
                    "<>", "\"\<.\>\""}], ",", "\[IndentingNewLine]", "#"}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\< \>\""}], "]"}], "]"}], "&"}], "/@", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Author\>\""}], "]"}]}], 
                    ",", "\"\<, \>\""}], "]"}]}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}], "=!=", 
                  RowBox[{"{", "}"}]}], "&&", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}], "=!=",
                   "None"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"Sow", "[", 
                 RowBox[{"StringJoin", "@@", 
                  RowBox[{"Riffle", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], ">", "3"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], ",", "\"\<et al\>\""}], "}"}], 
                    ",", "#"}], "]"}], "&"}], "[", 
                    RowBox[{"Sort", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\< \>\""}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Editor\>\""}], "]"}]}], 
                    "]"}], "]"}], ",", "\"\<, \>\""}], "]"}]}], "]"}]}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"title", ",", 
                RowBox[{"Sow", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"url", "&&", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"FormatReference", ",", "\"\<Format\>\""}], "]"}],
                     "===", "\"\<Web\>\""}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<URL\>\""}], "]"}]}], "]"}],
                     ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"FormatReference", ",", "\"\<Format\>\""}], "]"}],
                     "===", "\"\<Paper\>\""}], ",", "\[IndentingNewLine]", 
                    "#", ",", "True", ",", "#"}], "]"}], "&"}], "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"book", ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"FontSlant", "\[Rule]", "Italic"}]}], "]"}], ",", 
                    
                    RowBox[{
                    "\"\<\[OpenCurlyDoubleQuote]\>\"", "<>", "#", "<>", 
                    "\"\<\[CloseCurlyDoubleQuote]\>\""}]}], "]"}], "&"}], "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Title\>\""}], "]"}], "]"}],
                   "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Volume\>\""}], "]"}], "=!=", 
                 "None"}], ",", 
                RowBox[{
                 RowBox[{"Sow", "[", 
                  RowBox[{"\"\<vol. \>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Volume\>\""}], "]"}], 
                    "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Number\>\""}], "]"}], "=!=",
                     "None"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Sow", "[", 
                    RowBox[{"\"\<no. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Number\>\""}], "]"}], 
                    "]"}]}], "]"}]}], "]"}]}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Head", "[", 
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Edition\>\""}], "]"}], 
                  "]"}], "===", "Integer"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], "<>", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"#", ",", "10"}], "]"}], "\[Equal]", "1"}], ",", 
                    "\"\<st\>\"", ",", 
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"#", ",", "10"}], "]"}], "\[Equal]", "2"}], ",", 
                    "\"\<nd\>\"", ",", 
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"#", ",", "10"}], "]"}], "\[Equal]", "3"}], ",", 
                    "\"\<rd\>\"", ",", "True", ",", "\"\<th\>\""}], "]"}], 
                    "<>", "\"\< ed.\>\""}], "]"}], "&"}], "[", 
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Edition\>\""}], "]"}], 
                 "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"book", ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Publisher\>\""}], "]"}], "=!=",
                    "None"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"Sow", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Publisher\>\""}], "]"}], 
                   "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Source\>\""}], "]"}], "=!=",
                    "None"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"Sow", "[", 
                   RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Source\>\""}], "]"}], ",", 
                    
                    RowBox[{"FontSlant", "\[Rule]", "Italic"}]}], "]"}], 
                   "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<Citation\>\""}], "]"}], 
                  "===", "\"\<URL\>\""}], "&&", "url", "&&", 
                 RowBox[{
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"FormatReference", ",", "\"\<Format\>\""}], "]"}], 
                  "=!=", "\"\<Web\>\""}]}], ",", "\[IndentingNewLine]", 
                RowBox[{"Sow", "[", 
                 RowBox[{"\"\<<\>\"", "<>", 
                  RowBox[{"OptionValue", "[", 
                   RowBox[{"Reference", ",", "\"\<URL\>\""}], "]"}], "<>", 
                  "\"\<>\>\""}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Date\>\""}], "]"}], "=!=", 
                 RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"\"\<Year\>\"", "\[Rule]", "_"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"\"\<Month\>\"", "\[Rule]", "_"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"\"\<Day\>\"", "\[Rule]", "_"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"DateString", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<Year\>\"", ",", "\"\<Month\>\"", ",", "\"\<Day\>\"", 
                    ",", "0", ",", "0", ",", "0"}], "}"}], "/.", "#"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<DayShort\>\"", ",", "\"\< \>\"", ",", 
                    "\"\<MonthNameShort\>\"", ",", "\"\< \>\"", ",", 
                    "\"\<Year\>\""}], "}"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"DateString", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<Year\>\"", ",", "\"\<Month\>\"", ",", "0", ",", "0", 
                    ",", "0", ",", "0"}], "}"}], "/.", "#"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<MonthNameShort\>\"", ",", "\"\< \>\"", ",", 
                    "\"\<Year\>\""}], "}"}]}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"DateString", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<Year\>\"", "+", "1"}], ",", "0", ",", "0", 
                    ",", "0", ",", "0", ",", "0"}], "}"}], "/.", "#"}], ",", 
                    RowBox[{"{", "\"\<Year\>\"", "}"}]}], "]"}]}], "]"}], 
                    "]"}]}], "]"}], "&"}], "[", 
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Date\>\""}], "]"}], "]"}]}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "=!=", 
                 "None"}], ",", "\[IndentingNewLine]", 
                RowBox[{"Switch", "[", 
                 RowBox[{
                  RowBox[{"Head", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                   ",", "\[IndentingNewLine]", "Integer", ",", 
                  RowBox[{"\"\<pg. \>\"", "<>", 
                   RowBox[{"ToString", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", "List", ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pg. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], "]"}],
                     ">", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Sow", "[", 
                    RowBox[{"\"\<pp. \>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "]"}], "<>", "\"\<-\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{
                    RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Pages\>\""}], "]"}], 
                    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                    "]"}]}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                 "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], "=!=",
                  "None"}], ",", 
                RowBox[{"Sow", "[", 
                 RowBox[{"\"\<footnote \>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"OptionValue", "[", 
                    RowBox[{"Reference", ",", "\"\<Footnote\>\""}], "]"}], 
                   "]"}]}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
             "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
         "]"}], ",", "\[IndentingNewLine]", "\"\< \>\""}], "]"}], "]"}]}], 
    "]"}], "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"OptionValue", "[", 
      RowBox[{"Reference", ",", "\"\<Title\>\""}], "]"}], "=!=", "None"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"OptionValue", "[", 
      RowBox[{"Reference", ",", "\"\<URL\>\""}], "]"}], "=!=", "None"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"MemberQ", "[", 
     RowBox[{
      RowBox[{"{", "\"\<Book\>\"", "}"}], ",", 
      RowBox[{"OptionValue", "[", 
       RowBox[{"Reference", ",", "\"\<Citation\>\""}], "]"}]}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.5781537131909714`*^9, {3.578154072510523*^9, 3.5781541028542585`*^9}, {
   3.5781541726532507`*^9, 3.578154185032959*^9}, {3.578154374660805*^9, 
   3.5781543957840133`*^9}, {3.578154468501172*^9, 3.57815451549086*^9}, {
   3.5781545488527684`*^9, 3.578154574866256*^9}, {3.578154670132705*^9, 
   3.578154688290744*^9}, {3.5781547251588526`*^9, 3.5781548021222544`*^9}, {
   3.578154984729699*^9, 3.5781552162879434`*^9}, {3.578155359758149*^9, 
   3.5781553755190506`*^9}, {3.578155407345871*^9, 3.5781554362335234`*^9}, {
   3.57815557534348*^9, 3.578155611447545*^9}, {3.5781556527359066`*^9, 
   3.578155757471897*^9}, {3.578155798352236*^9, 3.5781558059966726`*^9}, {
   3.578155932561912*^9, 3.578155934193005*^9}, {3.5781559981906652`*^9, 
   3.5781560177827864`*^9}, {3.578160369580695*^9, 3.578160429543124*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FormatReference", "[", 
   RowBox[{"ref_", ",", "opts__"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"last", "=", 
      RowBox[{"{", "}"}]}], "}"}], ",", 
    RowBox[{"ref", "/.", 
     RowBox[{"x_Reference", "\[RuleDelayed]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", "===", "last"}], ",", 
           RowBox[{"FormatReference", "[", 
            RowBox[{"x", ",", 
             RowBox[{"\"\<Abbreviation\>\"", "\[Rule]", "\"\<Ibid\>\""}], ",",
              "opts"}], "]"}], ",", 
           RowBox[{
            RowBox[{"last", "=", "#"}], ";", 
            RowBox[{"FormatReference", "[", 
             RowBox[{"x", ",", "opts"}], "]"}]}]}], "]"}], "&"}], "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<Title\>\"", ",", "\"\<Authors\>\""}], "}"}], "/.", 
         RowBox[{"(", 
          RowBox[{"List", "@@", "x"}], ")"}]}], "]"}], ")"}]}]}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"Clear", "[", "PrintFootnotes", "]"}]], "Input",
 CellChangeTimes->{{3.5781563622364883`*^9, 3.5781563653756676`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PrintFootnotes", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Style\>\"", "\[Rule]", "\"\<Short\>\""}], ",", 
     RowBox[{"\"\<ReferenceOptions\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.578156222558499*^9, 3.5781562488250012`*^9}, 
   3.5781563558501225`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrintFootnotes", "[", 
   RowBox[{"context_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"mentioned", ",", "number"}], "}"}], ",", "\[IndentingNewLine]", 
    
    RowBox[{
     RowBox[{
      RowBox[{"mentioned", "[", "_", "]"}], "=", "False"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"number", "[", 
       RowBox[{
        RowBox[{"Row", "[", "A___", "]"}], ",", "z_"}], "]"}], ":=", 
      RowBox[{"Row", "[", 
       RowBox[{
        RowBox[{"z", "<>", "\"\<. \>\""}], ",", "A"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"number", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Row", "[", "A___", "]"}], ",", "B___"}], "}"}], ",", 
        "z_"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Row", "[", 
         RowBox[{
          RowBox[{"z", "<>", "\"\<. \>\""}], ",", "A"}], "]"}], ",", "B"}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "formatReference", ",", "formattedCitation", ",", "findCase", ",", 
         "checkMention"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"formatReference", "[", "R_", "]"}], "[", 
          RowBox[{"J_", ",", "m_"}], "]"}], ":=", 
         RowBox[{"FormatReference", "[", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"R", ",", "J"}], "]"}], ",", 
           RowBox[{"OptionValue", "[", 
            RowBox[{"PrintFootnotes", ",", "\"\<ReferenceOptions\>\""}], 
            "]"}], ",", 
           RowBox[{"\"\<Abbreviation\>\"", "\[Rule]", "m"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"findCase", "[", "\[CapitalLambda]_", "]"}], ":=", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"References", "[", "context", "]"}], ",", 
           RowBox[{"Reference", "[", 
            RowBox[{"___", ",", 
             RowBox[{"\"\<Title\>\"", "\[Rule]", "\[CapitalLambda]"}], ",", 
             "___"}], "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"checkMention", "[", "\[CapitalLambda]_", "]"}], ":=", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OptionValue", "[", 
             RowBox[{"PrintFootnotes", ",", "\"\<Style\>\""}], "]"}], "===", 
            "\"\<Short\>\""}], ",", "\"\<Citation\>\"", ",", 
           RowBox[{
            RowBox[{"OptionValue", "[", 
             RowBox[{"PrintFootnotes", ",", "\"\<Style\>\""}], "]"}], "===", 
            "\"\<Long\>\""}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mentioned", "[", "\[CapitalLambda]", "]"}], ",", 
             "\"\<Citation\>\"", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"mentioned", "[", "\[CapitalLambda]", "]"}], "=", 
               "True"}], ";", "None"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"formattedCitation", "[", 
          RowBox[{"\[CapitalLambda]_", ",", "opts___"}], "]"}], ":=", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"#", "===", 
              RowBox[{"{", "}"}]}], ",", 
             RowBox[{
             "\"\<<<<UNKNOWN:\>\"", "<>", "\[CapitalLambda]", "<>", 
              "\"\<>>>\>\""}], ",", 
             RowBox[{
              RowBox[{"formatReference", "[", 
               RowBox[{"Reference", "[", "opts", "]"}], "]"}], "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", 
               RowBox[{"checkMention", "[", "\[CapitalLambda]", "]"}]}], 
              "]"}]}], "]"}], "&"}], "[", 
          RowBox[{"findCase", "[", "\[CapitalLambda]", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"CellPrint", "[", 
           RowBox[{"Cell", "[", 
            RowBox[{
             RowBox[{"TextData", "[", "#", "]"}], ",", "\"\<Footnote\>\""}], 
            "]"}], "]"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"number", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"ToString", "[", 
                  RowBox[{
                  "#2", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "]"}], "&"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"Footnotes", "[", "context", "]"}], 
                "\[LeftDoubleBracket]", 
                RowBox[{"Last", "/@", 
                 RowBox[{"Sort", "[", 
                  RowBox[{"Cases", "[", 
                   RowBox[{
                    RowBox[{"DownValues", "[", "ReferenceCounter", "]"}], ",", 
                    RowBox[{
                    RowBox[{"HoldPattern", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "RuleDelayed"}], ")"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "HoldPattern"}], ")"}], "[", 
                    RowBox[{"ReferenceCounter", "[", 
                    RowBox[{"\[Angle]_", ",", "context"}], "]"}], "]"}], ",", 
                    "\[WeierstrassP]_"}], "]"}], "]"}], "\[RuleDelayed]", 
                    RowBox[{"{", 
                    RowBox[{"\[WeierstrassP]", ",", "\[Angle]"}], "}"}]}]}], 
                   "]"}], "]"}]}], "\[RightDoubleBracket]"}], "/.", 
               RowBox[{"Citation", "\[Rule]", "formattedCitation"}]}]}], 
             "]"}], "]"}], "//.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Row", "\[Rule]", "List"}], ",", 
             RowBox[{
              RowBox[{"Hyperlink", "[", 
               RowBox[{"z_", ",", "l_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"ButtonBox", "[", 
               RowBox[{"z", ",", 
                RowBox[{"BaseStyle", "\[Rule]", "\"\<Hyperlink\>\""}], ",", 
                RowBox[{"ButtonData", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"l", ",", "None"}], "}"}]}]}], "]"}]}], ",", 
             RowBox[{"Style", "\[Rule]", "StyleBox"}]}], "}"}]}], ")"}]}]}]}],
       "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAmIQbcO2SOujzytHt9IDYNpI+9ScUyteOTbckp0LorfM
OLMaRLeVnl4Dovlzlm0B0QwBF8C0xd32vSC6xnXyPhC9TajtBIj+9kr+DIjm
ehF1EUQn/V95CWxedMc1EK3jZPIQRAe92v0GRC9oYfsCog0nLyw+A6QPTD0C
psXmSlSB6DP3M8D0LpvM1k9rXzm+MGgB07Ui0n0g2uTT7Ckg+s5crjkgOuNQ
HpiekJa4CkTbbpXZCKIZp0ftBtGzEvj2gOi9wfrHQPSC9y+ug2jx/dp38tcD
/fnJ9wmIPhdx5AWIjllh9RJEz4m4+B5E6+qHfwfRp5UzfoNohdknpQuAtNau
Ln0QXXrxtg2I3lcU7wKiZ2zu9wDRv5Jkw0F0QeW1eBC9UWl5Koj+fuxkIYj2
+vvIrAxIT7nzDEwDAHyL88g=
  "]],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrintUnusedFootnotes", "[", "context_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CellPrint", "[", 
     RowBox[{"Cell", "[", 
      RowBox[{
       RowBox[{"TextData", "[", "#", "]"}], ",", "\"\<Paragraph\>\""}], "]"}],
      "]"}], "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"MapIndexed", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "List"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"MapAt", "[", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{"z", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"ToString", "[", 
                  RowBox[{
                  "#2", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}], "<>", "\"\<. \>\""}], 
                ",", 
                RowBox[{"Flatten", "[", "z", "]"}]}], "}"}]}], "]"}], ",", 
            "#", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "]"}], "<>", "\"\<. \>\""}], ",", 
            RowBox[{"Flatten", "[", "#", "]"}]}], "}"}]}], "]"}], "&"}], ",", 
       
       RowBox[{
        RowBox[{"FormatReference", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{"Footnotes", "[", "context", "]"}], ",", 
             RowBox[{"List", "/@", 
              RowBox[{"Last", "/@", 
               RowBox[{"Sort", "[", 
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"DownValues", "[", "ReferenceCounter", "]"}], ",", 
                  RowBox[{
                   RowBox[{"HoldPattern", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "RuleDelayed"}], ")"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "HoldPattern"}], ")"}], "[", 
                    RowBox[{"ReferenceCounter", "[", 
                    RowBox[{"\[Angle]_", ",", "context"}], "]"}], "]"}], ",", 
                    "\[WeierstrassP]_"}], "]"}], "]"}], "\[RuleDelayed]", 
                   RowBox[{"{", 
                    RowBox[{"\[WeierstrassP]", ",", "\[Angle]"}], "}"}]}]}], 
                 "]"}], "]"}]}]}]}], "]"}], "/.", 
           RowBox[{
            RowBox[{"Citation", "[", 
             RowBox[{"\[CapitalLambda]_", ",", "opts___"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Reference", "[", "opts", "]"}], ",", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{
                 RowBox[{"References", "[", "context", "]"}], ",", 
                 RowBox[{"Reference", "[", 
                  RowBox[{"___", ",", 
                   RowBox[{"\"\<Title\>\"", "\[Rule]", "\[CapitalLambda]"}], 
                   ",", "___"}], "]"}], ",", "1"}], "]"}], 
               "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
             "]"}]}]}], ",", 
          RowBox[{"\"\<Format\>\"", "\[Rule]", "\"\<Web\>\""}], ",", 
          RowBox[{"\"\<Abbreviation\>\"", "\[Rule]", "\"\<Citation\>\""}]}], 
         "]"}], "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Row", "\[Rule]", "List"}], ",", 
          RowBox[{
           RowBox[{"Hyperlink", "[", 
            RowBox[{"z_", ",", "l_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"ButtonBox", "[", 
            RowBox[{"z", ",", 
             RowBox[{"BaseStyle", "\[Rule]", "\"\<Hyperlink\>\""}], ",", 
             RowBox[{"ButtonData", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"l", ",", "None"}], "}"}]}]}], "]"}]}], ",", 
          RowBox[{"Style", "\[Rule]", "StyleBox"}]}], "}"}]}]}], "]"}], ",", 
     "1"}], "]"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PrintWorksCited", "[", "context_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"CellPrint", "[", 
     RowBox[{"Cell", "[", 
      RowBox[{
       RowBox[{"TextData", "[", 
        RowBox[{"Append", "[", 
         RowBox[{"#", ",", "\"\<.\>\""}], "]"}], "]"}], ",", 
       "\"\<Reference\>\""}], "]"}], "]"}], "&"}], "/@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"FormatReference", "[", 
      RowBox[{
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Footnotes", "[", "context", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{"Last", "/@", 
               RowBox[{"Sort", "[", 
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"DownValues", "[", "ReferenceCounter", "]"}], ",", 
                  RowBox[{
                   RowBox[{"HoldPattern", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "RuleDelayed"}], ")"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"_", ":", "HoldPattern"}], ")"}], "[", 
                    RowBox[{"ReferenceCounter", "[", 
                    RowBox[{"\[Angle]_", ",", "context"}], "]"}], "]"}], ",", 
                    "\[WeierstrassP]_"}], "]"}], "]"}], "\[RuleDelayed]", 
                   RowBox[{"{", 
                    RowBox[{"\[WeierstrassP]", ",", "\[Angle]"}], "}"}]}]}], 
                 "]"}], "]"}]}], "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Citation", "[", "__", "]"}], ",", "\[Infinity]"}], 
            "]"}], "/.", 
           RowBox[{
            RowBox[{"Citation", "[", 
             RowBox[{"\[CapitalLambda]_", ",", "opts___"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"Cases", "[", 
              RowBox[{
               RowBox[{"References", "[", "context", "]"}], ",", 
               RowBox[{"Reference", "[", 
                RowBox[{"___", ",", 
                 RowBox[{"\"\<Title\>\"", "\[Rule]", "\[CapitalLambda]"}], 
                 ",", "___"}], "]"}], ",", "1"}], "]"}], 
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ",", 
          
          RowBox[{
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"StringSplit", "[", 
                 RowBox[{"#", ",", "\"\< \>\""}], "]"}], 
                "\[LeftDoubleBracket]", 
                RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "&"}], "/@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", 
                RowBox[{"\"\<Author\>\"", "/.", 
                 RowBox[{"(", 
                  RowBox[{"List", "@@", "#"}], ")"}]}], "}"}], "]"}]}], "]"}],
             "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "&"}]}], 
         "]"}], "]"}], "\[IndentingNewLine]", ",", 
       RowBox[{"\"\<Format\>\"", "\[Rule]", "\"\<Web\>\""}]}], "]"}], "//.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Row", "\[Rule]", "List"}], ",", 
       RowBox[{
        RowBox[{"Hyperlink", "[", 
         RowBox[{"z_", ",", "l_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"ButtonBox", "[", 
         RowBox[{"z", ",", 
          RowBox[{"BaseStyle", "\[Rule]", "\"\<Hyperlink\>\""}], ",", 
          RowBox[{"ButtonData", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"l", ",", "None"}], "}"}]}]}], "]"}]}], ",", 
       RowBox[{"Style", "\[Rule]", "StyleBox"}]}], "}"}]}], 
    ")"}]}]}]], "Input",
 CellChangeTimes->{{3.52995468466153*^9, 3.5299547187804813`*^9}, {
  3.5299550184046187`*^9, 3.5299550355876017`*^9}, {3.529955113604064*^9, 
  3.5299551494441137`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetReferenceCounters", "[", "context_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Unset", "[", 
       RowBox[{"ReferenceCounter", "[", 
        RowBox[{"#", ",", "context"}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"DownValues", "[", "ReferenceCounter", "]"}], ",", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "RuleDelayed"}], ")"}], "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"_", ":", "HoldPattern"}], ")"}], "[", 
            RowBox[{"ReferenceCounter", "[", 
             RowBox[{"z_", ",", "context"}], "]"}], "]"}], ",", "_"}], "]"}], 
         "]"}], "\[RuleDelayed]", "z"}]}], "]"}]}], ";", 
    RowBox[{"MapIndexed", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ReferenceCounter", "[", 
          RowBox[{"#", ",", "context"}], "]"}], "=", 
         RowBox[{
         "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        ")"}], "&"}], ",", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FindSection", "[", "context", "]"}], ",", 
        RowBox[{
         RowBox[{"HoldPattern", "[", 
          RowBox[{"$CellContext`ReferenceCounter", "[", 
           RowBox[{"g_", ",", "context"}], "]"}], "]"}], "\[RuleDelayed]", 
         "g"}], ",", "\[Infinity]"}], "]"}]}], "]"}], ";"}], ")"}]}]], "Input",\

 CellChangeTimes->{{3.5905802348178663`*^9, 3.590580239063404*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetReferenceCounters", "[", 
   RowBox[{"context_", ",", "domain_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Unset", "[", 
       RowBox[{"ReferenceCounter", "[", 
        RowBox[{"#", ",", "context"}], "]"}], "]"}], "&"}], "/@", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"DownValues", "[", "ReferenceCounter", "]"}], ",", 
       RowBox[{
        RowBox[{"HoldPattern", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "RuleDelayed"}], ")"}], "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"_", ":", "HoldPattern"}], ")"}], "[", 
            RowBox[{"ReferenceCounter", "[", 
             RowBox[{"z_", ",", "context"}], "]"}], "]"}], ",", "_"}], "]"}], 
         "]"}], "\[RuleDelayed]", "z"}]}], "]"}]}], ";", 
    RowBox[{"MapIndexed", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ReferenceCounter", "[", 
          RowBox[{"#", ",", "context"}], "]"}], "=", 
         RowBox[{
         "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        ")"}], "&"}], ",", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"FindSection", "[", "context", "]"}], ",", 
          RowBox[{
           RowBox[{"CellGroupData", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Cell", "[", 
                RowBox[{"p_", ",", "___"}], "]"}], ",", "___"}], "}"}], ",", 
             "___"}], "]"}], "/;", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"domain", ",", "p"}], "]"}]}], ",", "\[Infinity]"}], 
         "]"}], ",", 
        RowBox[{
         RowBox[{"HoldPattern", "[", 
          RowBox[{"$CellContext`ReferenceCounter", "[", 
           RowBox[{"g_", ",", "context"}], "]"}], "]"}], "\[RuleDelayed]", 
         "g"}], ",", "\[Infinity]"}], "]"}]}], "]"}], ";"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.5905802488746433`*^9, 3.590580252225068*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mathematical Expression Management", "Title"],

Cell[CellGroupData[{

Cell["Notes", "Section"],

Cell[CellGroupData[{

Cell["Data Structures", "Subsection"],

Cell["\<\
It should be possible to hover the mouse over different parts of a \
mathematical expression to learn precisely what it means. \
\>", "Paragraph"],

Cell["Data structures I\[CloseCurlyQuote]ll need: ", "Paragraph"],

Cell[CellGroupData[{

Cell["\<\
Replacement Rules. These might be displayed as separate cells or inline rules \
occaisionally. \
\>", "Item"],

Cell["\<\
Mathematical rule \[Dash] something that specifies how one expression can be \
transformed into another. \
\>", "Subitem"],

Cell["Name\[LongDash]optional", "Subsubitem"],

Cell["Unique ID/hash\[LongDash]optional", "Subsubitem"],

Cell["\<\
Content\[LongDash]short form and long form. \
\>", "Subsubitem"],

Cell["\<\
Definition \[Dash] a kind of a mathematical rule. \
\>", "Subitem"],

Cell["\<\
Proposition \[Dash] a kind of a mathematical rule. \
\>", "Subitem"],

Cell["\<\
Type\[LongDash]lemma, proposition, theorem, or anzatz. \
\>", "Subsubitem"],

Cell["Abstract representation of the steps. ", "Subsubitem"],

Cell["Expressions. ", "Item"],

Cell["Relationships. ", "Item"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Architecture", "Subsection"],

Cell["\<\
Expressions consist of a nested tree of subexpressions, each of leaf of which \
may be associated with another expression that represents the rule being \
applied or the definition of the symbol. The association may be inline, or it \
may be via a unique identifier that can be retrieved. If it is a unique \
identifier, there is a link to its statement within the document. \
\>", "Paragraph"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Fantasy Language Generator", "Title"],

Cell[CellGroupData[{

Cell["The Language Program", "Section"],

Cell[CellGroupData[{

Cell["Phrases in General", "Subsection"],

Cell[CellGroupData[{

Cell["Default Options", "Subsubsection"],

Cell["\<\
The default options for phrases. NOTE: need a category for whether a verb's \
subject or object is active.\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Phrase", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<Case\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<NounClass\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<VerbClass\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Number\>\"", "\[Rule]", "\"\<Singular\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Person\>\"", "\[Rule]", "\"\<Third\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Definiteness\>\"", "\[Rule]", "\"\<Neutral\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Focus\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Topic\>\"", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Agent\>\"", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<Tense\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Mood\>\"", "\[Rule]", "\"\<Indicative\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Evidentiality\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Aspect\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Polarity\>\"", "\[Rule]", "True"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Voice\>\"", "\[Rule]", "\"\<Active\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Transformation\>\"", "\[Rule]", "\"\<Automatic\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Transitivity\>\"", "\[Rule]", "\"\<Intransitive\>\""}], ",",
      "\[IndentingNewLine]", 
     RowBox[{"\"\<TransformationType\>\"", "\[Rule]", "None"}]}], "}"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{
  "Phrase", ",", "AllowedOptions", ",", "InheritedOptions", ",", 
   "ArgumentInheritance", ",", "BackwardsInheritedOptions"}], "]"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Case\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<Nominative\>\"", ",", "\"\<Accusative\>\"", ",", 
       "\"\<Dative\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Genitive\>\"", ",", "\"\<Adpositional\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Ergative\>\"", ",", "\"\<Absolutive\>\"", ",", "\"\<Dative\>\""}], 
      "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<NounClass\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<Masculine\>\"", ",", "\"\<Feminine\>\"", ",", "\"\<Neuter\>\"", 
       ",", "\"\<Hermaphrodite\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Animate\>\"", ",", "\"\<Inanimate\>\""}], "}"}]}], "}"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<VerbClass\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"{", "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Aspect\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"{", 
     RowBox[{"\"\<Perfective\>\"", ",", "\"\<Imperfective\>\""}], "}"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Mood\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Indicative\>\"", ",", "\"\<Interrogative\>\"", ",", 
     "\"\<Conditional\>\"", ",", "\"\<Subjunctive\>\"", ",", 
     "\"\<Imperative\>\"", ",", "\"\<Optative\>\"", ",", "\"\<Injunctive\>\"",
      ",", "\"\<Potential\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Person\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<First\>\"", ",", "\"\<Second\>\"", ",", "\"\<Third\>\"", ",", 
     "\"\<Fourth\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Tense\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Present\>\"", ",", "\"\<Past\>\"", ",", "\"\<Future\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Number\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Singular\>\"", ",", "\"\<Dual\>\"", ",", "\"\<Plural\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Definiteness\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Indefinite\>\"", ",", "\"\<Definite\>\"", ",", "\"\<Neutral\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Polarity\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Definitenes\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Focus\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Topic\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Agent\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Polarity\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"True", ",", "False"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Voice\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Active\>\"", ",", "\"\<Passive\>\"", ",", "\"\<Middle\>\"", ",", 
     "\"\<Antipassive\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Transitivity\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Avalent\>\"", ",", "\"\<Intransitive\>\"", ",", "\"\<Transitive\>\"",
      ",", "\"\<Trivalent\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Transformation\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Infinitive\>\"", ",", "\"\<Gerund\>\"", ",", "\"\<Gerundive\>\"", 
     ",", "\"\<Participal\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<Evidentiality\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Direct\>\"", ",", "\"\<Inferential\>\"", ",", 
     "\"\<Reportative\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllowedOptions", "[", 
    RowBox[{"\"\<TransformationType\>\"", ","}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Cardinal\>\"", ",", "\"\<Ordinal\>\"", ",", "\"\<Infinitive\>\"", 
     ",", "\"\<Participal\>\""}], "}"}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ListedOptions", "[", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Case\>\"", ",", "\"\<NounClass\>\"", ",", "\"\<Aspect\>\"", ",", 
     "\"\<VerbClass\>\""}], "}"}]}], ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"InheritedOptions", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InheritedOptions", "[", 
    RowBox[{"\"\<Nominal\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Case\>\"", ",", "\"\<NounClass\>\"", ",", "\"\<Number\>\"", ",", 
     "\"\<Person\>\"", ",", "\"\<Definiteness\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InheritedOptions", "[", 
    RowBox[{"\"\<Verbal\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<Transitivity\>\"", ",", "\"\<Voice\>\"", ",", "\"\<Mood\>\"", ",", 
     "\"\<Aspect\>\"", ",", "\"\<Tense\>\"", ",", "\"\<Polarity\>\""}], 
    "}"}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BackwardsInheritedOptions", "[", "]"}], "=", 
   RowBox[{"{", "\"\<Focus\>\"", "}"}]}], ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ArgumentInheritance", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ArgumentInheritance", "[", 
    RowBox[{"\"\<Verbal\>\"", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Transitivity\>\"", "\[Rule]", "\"\<Monovalent\>\""}], 
       "}"}], "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Transitivity\>\"", "\[Rule]", "\"\<Intransitive\>\""}], 
       "}"}], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<Case\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Nominative\>\"", ",", "\"\<Absolutive\>\""}], "}"}]}], 
       "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Transitivity\>\"", "\[Rule]", "\"\<Transitive\>\""}], 
       "}"}], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Case\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<Nominative\>\"", ",", "\"\<Ergative\>\""}], "}"}]}], 
        ",", 
        RowBox[{"\"\<Case\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<Accusative\>\"", ",", "\"\<Absolutive\>\""}], 
          "}"}]}]}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<Transitivity\>\"", "\[Rule]", "\"\<Trivalent\>\""}], 
       "}"}], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<Case\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<Nominative\>\"", ",", "\"\<Ergative\>\""}], "}"}]}], 
        ",", 
        RowBox[{"\"\<Case\>\"", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"\"\<Accusative\>\"", ",", "\"\<Absolutive\>\""}], "}"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<Case\>\"", "\[Rule]", 
         RowBox[{"{", "\"\<Dative\>\"", "}"}]}]}], "}"}]}]}], "}"}]}], 
  ";"}]}], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Generating Phrases from Expression", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{
  "GeneratePhrase", ",", "Modify", ",", "TestOption", ",", 
   "ApplyGrammarTransformation", ",", "GrammarTransformation"}], 
  "]"}]], "Input"],

Cell["A function that combines options.", "Paragraph"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Modify", "[", 
   RowBox[{"L_String", ",", "\[Phi]_Phrase"}], "]"}], ":=", 
  "\[Phi]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Modify", "[", 
    RowBox[{"L_String", ",", "z_String", ",", "___"}], "]"}], ":=", "z"}], 
  ";"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Modify", "[", 
   RowBox[{"L_String", ",", "\[Phi]_Phrase", ",", "z_Rule", ",", "J__Rule"}], 
   "]"}], ":=", 
  RowBox[{"Modify", "[", 
   RowBox[{"L", ",", 
    RowBox[{"Modify", "[", 
     RowBox[{"L", ",", "\[Phi]", ",", "z"}], "]"}], ",", "J"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Modify", "[", 
   RowBox[{"L_String", ",", "\[Phi]_Phrase", ",", 
    RowBox[{"b_", "\[Rule]", "p_List"}]}], "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Modify", "[", 
      RowBox[{"L", ",", "#", ",", "#2"}], "]"}], "&"}], ",", "\[Phi]", ",", 
    RowBox[{
     RowBox[{
      RowBox[{"b", "\[Rule]", "#"}], "&"}], "/@", "p"}]}], "]"}]}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Modify", "[", 
   RowBox[{"L_String", ",", 
    RowBox[{"\[Phi]", ":", 
     RowBox[{"Phrase", "[", 
      RowBox[{"type_", ",", "head_", ",", "body___List", ",", "opts___Rule"}],
       "]"}]}], ",", 
    RowBox[{"b_", "\[Rule]", "p_"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"MemberQ", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"AllowedOptions", "[", 
        RowBox[{"b", ",", "L"}], "]"}], "]"}], ",", "p"}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{
        RowBox[{"{", "opts", "}"}], ",", 
        RowBox[{"b", "\[Rule]", "_"}]}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MatchQ", "[", 
         RowBox[{
          RowBox[{"AllowedOptions", "[", 
           RowBox[{"b", ",", "L"}], "]"}], ",", 
          RowBox[{"{", "__List", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Phrase", "[", 
         RowBox[{"type", ",", "head", ",", "body", ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], "/.", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"b", "\[Rule]", "_"}], ")"}], "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"b", "\[Rule]", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{"p", ",", 
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"b", "/.", 
                    RowBox[{"{", "opts", "}"}]}], "}"}], "]"}], ",", 
                    RowBox[{"Except", "[", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"AllowedOptions", "[", 
                    RowBox[{"b", ",", "L"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                   "}"}], "]"}]}], ")"}]}]}], ")"}]}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Phrase", "[", 
         RowBox[{"type", ",", "head", ",", "body", ",", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "opts", "}"}], "/.", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"b", "\[Rule]", "_"}], ")"}], "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"b", "\[Rule]", "p"}], ")"}]}]}], ")"}]}]}], "]"}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Phrase", "[", 
       RowBox[{"type", ",", "head", ",", "body", ",", 
        RowBox[{"b", "\[Rule]", "p"}], ",", "opts"}], "]"}]}], "]"}], ",", 
    "\[IndentingNewLine]", "\[Phi]"}], "]"}]}]], "Input"],

Cell["A function that tests options. ", "Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestOption", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"type_", ",", "parts__", ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ",", 
    RowBox[{"b_", "\[Rule]", "q_"}]}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{"#2", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{"p", ",", 
         RowBox[{"And", "@@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{"p", ",", "#"}], "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", "q", "}"}], "]"}]}], ")"}]}]}], "]"}], "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "#", "}"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"#", "===", "q"}]}], "]"}], "&"}], "[", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"BackwardsInheritedOptions", "[", "]"}], ",", "b"}], "]"}], "&&", 
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{
          RowBox[{"{", "parts", "}"}], "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], "]"}], "=!=", "List"}]}], ",", 
      RowBox[{"TestOption", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", "parts", "}"}], "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}], ",", 
        RowBox[{"b", "\[Rule]", "q"}]}], "]"}], ",", 
      RowBox[{"OptionValue", "[", 
       RowBox[{"Phrase", ",", "b"}], "]"}]}], "]"}], ",", 
    RowBox[{"MemberQ", "[", 
     RowBox[{
      RowBox[{"ListedOptions", "[", "]"}], ",", "b"}], "]"}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TestOption", "[", 
   RowBox[{"\[Phi]_Phrase", ",", "z_Rule", ",", "J__Rule"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"TestOption", "[", 
    RowBox[{"\[Phi]", ",", "z"}], "]"}], "&&", 
   RowBox[{"TestOption", "[", 
    RowBox[{"\[Phi]", ",", "J"}], "]"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TestOption", "[", "\[Phi]_", "]"}], "=", "True"}], ";"}]], "Input"],

Cell["\<\
The function that explains how to apply a grammar transformation. \
\>", "Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ApplyGrammarTransformation", "[", 
   RowBox[{
    RowBox[{"\[Phi]", ":", 
     RowBox[{"Phrase", "[", 
      RowBox[{"type_", ",", "head_", ",", 
       RowBox[{"arguments_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"modifiers_List:", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}]}], ",", 
    "\[CloverLeaf]_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[ReturnIndicator]", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"h", "=", 
       RowBox[{"{", "head", "}"}]}], ",", 
      RowBox[{"arg", "=", "arguments"}], ",", 
      RowBox[{"mod", "=", "modifiers"}], ",", "F", ",", "G", ",", 
      "\[ScriptCapitalQ]"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"G", "=", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{"\[GothicG]", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[ReturnIndicator]", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"\[ReturnIndicator]", ",", 
                RowBox[{"Extract", "[", 
                 RowBox[{"\[GothicG]", ",", "#"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"\[GothicG]", "=", 
              RowBox[{"Delete", "[", 
               RowBox[{"\[GothicG]", ",", "#"}], "]"}]}]}], ")"}], "&"}], "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"#", "/@", "\[GothicG]"}], ",", "True"}], "]"}], "]"}], 
         ",", "HoldFirst"}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", "[", "c_", "]"}], ":=", 
      RowBox[{"G", "[", 
       RowBox[{
        RowBox[{"TestOption", "[", 
         RowBox[{"#", ",", 
          RowBox[{"Sequence", "@@", "c"}]}], "]"}], "&"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", "[", 
       RowBox[{"c_", ",", "wd_String"}], "]"}], ":=", 
      RowBox[{"G", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"TestOption", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Sequence", "@@", "c"}]}], "]"}], "&&", 
         RowBox[{
          RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "===", "wd"}]}], "&"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[ScriptCapitalQ]", "[", 
       RowBox[{"{", "}"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[ReturnIndicator]", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{"\[ReturnIndicator]", ",", "h", ",", "arg", ",", "mod"}], 
           "}"}], "]"}]}], ";", 
        RowBox[{"h", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"arg", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"mod", "=", 
         RowBox[{"{", "}"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[ScriptCapitalQ]", "[", "s_String", "]"}], ":=", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"\[ReturnIndicator]", ",", "s"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[ScriptCapitalQ]", "[", 
       RowBox[{"j", ":", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Rule", "[", 
             RowBox[{"_List", ",", "_"}], "]"}], "|", 
            RowBox[{"_Argument", "[", "_", "]"}]}], ")"}], ".."}], "}"}]}], 
       "]"}], ":=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"#", "=!=", 
           RowBox[{"{", "}"}]}], ",", 
          RowBox[{"\[ScriptCapitalQ]", "[", "#", "]"}]}], "]"}], "&"}], "[", 
       RowBox[{"Replace", "[", 
        RowBox[{
         RowBox[{"Select", "[", 
          RowBox[{"j", ",", 
           RowBox[{"Function", "[", 
            RowBox[{"q", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Function", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"rule", ",", "argh"}], "}"}], ",", 
                  RowBox[{
                   RowBox[{"TestOption", "[", 
                    RowBox[{"#2", ",", 
                    RowBox[{"Sequence", "@@", "rule"}]}], "]"}], "&&", 
                   RowBox[{"(", 
                    RowBox[{"And", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Function", "[", 
                    RowBox[{"ar", ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "#2", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], "]"}], "<", 
                    RowBox[{"ar", "\[LeftDoubleBracket]", 
                    RowBox[{"0", ",", "1"}], "\[RightDoubleBracket]"}]}], ",",
                     "False", ",", 
                    RowBox[{"#0", "[", 
                    RowBox[{
                    RowBox[{"List", "@@", "ar"}], ",", 
                    RowBox[{"#2", "\[LeftDoubleBracket]", 
                    RowBox[{"3", ",", 
                    RowBox[{"ar", "\[LeftDoubleBracket]", 
                    RowBox[{"0", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                    "\[RightDoubleBracket]"}]}], "]"}]}], "]"}]}], "]"}], "/@",
                     "argh"}], ")"}]}], ")"}]}]}], "]"}], "[", 
                RowBox[{
                 RowBox[{"Cases", "[", 
                  RowBox[{"#", ",", "_Rule"}], "]"}], ",", 
                 RowBox[{"Cases", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{"_Argument", "[", "_", "]"}]}], "]"}]}], "]"}], 
               "&"}], "[", 
              RowBox[{
               RowBox[{
               "q", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "\[Phi]"}], "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
           "1"}], "]"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a_", "\[Rule]", "b_"}], "}"}], "\[RuleDelayed]", "b"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[ScriptCapitalQ]", "[", 
       RowBox[{"j", ":", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_List", "|", "_String"}], ")"}], ".."}], "}"}]}], "]"}], ":=", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[ScriptCapitalQ]", "[", "i", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[ScriptCapitalQ]", "[", 
       RowBox[{"i", ":", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_Symbol", "|", "_String", "|", "_Rule"}], ")"}], ".."}], 
         "}"}]}], "]"}], ":=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#1", "]"}], "<", "2"}], "&&", 
            RowBox[{
             RowBox[{"Length", "[", "#2", "]"}], "<", "2"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "#1", "]"}], "\[Equal]", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Switch", "[", 
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               ",", "\[IndentingNewLine]", "Head", ",", 
               RowBox[{
                RowBox[{"F", "[", 
                 RowBox[{"#3", ",", 
                  RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
                RowBox[{"Hold", "[", "h", "]"}]}], ",", "\[IndentingNewLine]",
                "Argument", ",", 
               RowBox[{
                RowBox[{"F", "[", 
                 RowBox[{"#3", ",", 
                  RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
                RowBox[{"Hold", "[", "arg", "]"}]}], ",", 
               "\[IndentingNewLine]", "Modifier", ",", 
               RowBox[{
                RowBox[{"F", "[", 
                 RowBox[{"#3", ",", 
                  RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
                RowBox[{"Hold", "[", "mod", "]"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"F", "[", 
                RowBox[{"#3", ",", 
                 RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
               RowBox[{"Hold", "[", "h", "]"}]}], ";", 
              RowBox[{
               RowBox[{"F", "[", 
                RowBox[{"#3", ",", 
                 RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
               RowBox[{"Hold", "[", "arg", "]"}]}], ";", 
              RowBox[{
               RowBox[{"F", "[", 
                RowBox[{"#3", ",", 
                 RowBox[{"Sequence", "@@", "#2"}]}], "]"}], "@@", 
               RowBox[{"Hold", "[", "mod", "]"}]}]}]}], "]"}]}], "]"}], ")"}],
         "&"}], "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"i", ",", "_Symbol"}], "]"}], "]"}], ",", 
        RowBox[{"Union", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"i", ",", "_String"}], "]"}], "]"}], ",", 
        RowBox[{"Cases", "[", 
         RowBox[{"i", ",", "_Rule"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[ScriptCapitalQ]", "[", "\[CloverLeaf]", "]"}], ";", 
     "\[IndentingNewLine]", "\[ReturnIndicator]"}]}], "]"}]}]], "Input",
 FontSize->10],

Cell["\<\
With these functions set, we can now create the function that transforms a \
grammar tree into a phrase in the fantasy language! \
\>", "Paragraph"],

Cell[BoxData[
 RowBox[{"Clear", "[", "GeneratePhrase", "]"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GeneratePhrase", "[", 
   RowBox[{"z_String", ",", "l__"}], "]"}], ":=", 
  "z"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GeneratePhrase", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"type_String", ",", "head_", ",", "opts___Rule"}], "]"}], ",", 
    "L_String", ",", "tropts___Rule"}], "]"}], ":=", 
  RowBox[{"GeneratePhrase", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"type", ",", "head", ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", "opts"}], "]"}], ",", "L", ",", "tropts"}], 
   "]"}]}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GeneratePhrase", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{
     "type_String", ",", "head_", ",", "body_List", ",", "opts___Rule"}], 
     "]"}], ",", "L_String", ",", "tropts___Rule"}], "]"}], ":=", 
  RowBox[{"GeneratePhrase", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"type", ",", "head", ",", 
      RowBox[{"{", "}"}], ",", "body", ",", "opts"}], "]"}], ",", "L", ",", 
    "tropts"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GeneratePhrase", "[", 
    RowBox[{
     RowBox[{"Phrase", "[", 
      RowBox[{"_", ",", "Null", ",", "___"}], "]"}], ",", "__"}], "]"}], "=", 
   "\"\<\>\""}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GeneratePhrase", "[", 
    RowBox[{
     RowBox[{"\[Phi]", ":", 
      RowBox[{"Phrase", "[", 
       RowBox[{
       "type_String", ",", "head_", ",", "arguments_List", ",", 
        "modifiers_List", ",", 
        RowBox[{"opts", ":", 
         RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}]}], ",", "L_String", 
     ",", 
     RowBox[{"tropts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"GeneratePhrase", "[", 
      RowBox[{"#", ",", "L", ",", "tropts"}], "]"}], "&"}], "/@", 
    RowBox[{"ApplyGrammarTransformation", "[", 
     RowBox[{
      RowBox[{"Phrase", "[", 
       RowBox[{"type", ",", "head", ",", 
        RowBox[{"MapThread", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Modify", "[", 
            RowBox[{"L", ",", "#1", ",", 
             RowBox[{"Sequence", "@@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"{", "#2", "}"}], "]"}]}]}], "]"}], "&"}], ",", 
          RowBox[{"{", 
           RowBox[{"arguments", ",", 
            RowBox[{"PadRight", "[", 
             RowBox[{
              RowBox[{"Replace", "[", 
               RowBox[{
                RowBox[{"Select", "[", 
                 RowBox[{
                  RowBox[{"ArgumentInheritance", "[", 
                   RowBox[{"type", ",", "L"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"TestOption", "[", 
                    RowBox[{"\[Phi]", ",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{
                    "#", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}]}], "]"}], "&"}], ",", "1"}], 
                 "]"}], ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a_", "\[Rule]", "b_"}], "}"}], "\[RuleDelayed]", 
                 "b"}]}], "]"}], ",", 
              RowBox[{"Length", "[", "arguments", "]"}], ",", "Null"}], 
             "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Modify", "[", 
           RowBox[{"L", ",", "#", ",", 
            RowBox[{"Sequence", "@@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "\[Rule]", 
                 RowBox[{"OptionValue", "[", 
                  RowBox[{"Phrase", ",", "#"}], "]"}]}], "&"}], "/@", 
               RowBox[{"InheritedOptions", "[", 
                RowBox[{"type", ",", "L"}], "]"}]}], ")"}]}]}], "]"}], "&"}], 
         "/@", "modifiers"}], ",", "opts"}], "]"}], ",", 
      RowBox[{"GrammarTransformation", "[", 
       RowBox[{"type", ",", "L"}], "]"}]}], "]"}]}]}], ";"}]], "Input"],

Cell["\<\
The default grammar transformation is simply to list everything with no \
inflection, head first.\
\>", "Paragraph"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GrammarTransformation", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "}"}], "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}]}], "}"}]}], ";"}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["Default Phonology", "Subsubsection"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{"Vowels", ",", "Consonents", ",", "MorphemeJoiner"}], 
  "]"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Vowels", "[", "_", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<a\>\"", ",", "\"\<e\>\"", ",", "\"\<i\>\"", ",", "\"\<o\>\"", ",", 
     "\"\<u\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Consonents", "[", "_", "]"}], "=", 
   RowBox[{"Characters", "[", "\"\<bcdfghjklmnpqrstvwxyz\>\"", "]"}]}], 
  ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MorphemeJoiner", "[", "L_", "]"}], ":=", 
  RowBox[{
   RowBox[{"FixedPoint", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"StringReplace", "[", 
       RowBox[{"#", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\< - \>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{"\"\< -\>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{"\"\<- \>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"x", ":", 
             RowBox[{"(", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"Vowels", "[", "L", "]"}]}], ")"}]}], "~~", 
            "\"\<*\>\"", "~~", 
            RowBox[{"y", ":", 
             RowBox[{"(", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"Vowels", "[", "L", "]"}]}], ")"}]}]}], 
           "\[RuleDelayed]", "y"}], ",", 
          RowBox[{"\"\<*\>\"", "\[Rule]", "\"\<\>\""}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"x", ":", 
             RowBox[{"(", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"Vowels", "[", "L", "]"}]}], ")"}]}], "~~", 
            "\"\<#\>\"", "~~", 
            RowBox[{"y", ":", 
             RowBox[{"(", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"Vowels", "[", "L", "]"}]}], ")"}]}]}], 
           "\[RuleDelayed]", "x"}], ",", 
          RowBox[{"\"\<#\>\"", "\[Rule]", "\"\<\>\""}]}], "}"}]}], "]"}], 
      "&"}], ",", 
     RowBox[{"StringJoin", "@@", 
      RowBox[{"Riffle", "[", 
       RowBox[{"#", ",", "\"\< \>\""}], "]"}]}]}], "]"}], "&"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GenerateRandomSyllable", "[", "context_", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "pick", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"pick", "[", 
        RowBox[{"a_", ",", "b_"}], "]"}], "/;", 
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], "\[NotEqual]", 
        RowBox[{"Length", "[", "b", "]"}]}]}], ":=", 
      RowBox[{"Throw", "[", "Null", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pick", "[", 
       RowBox[{
        RowBox[{"x", ":", 
         RowBox[{"StringExpression", "[", "__", "]"}]}], ",", 
        RowBox[{"y", ":", 
         RowBox[{"StringExpression", "[", "__", "]"}]}]}], "]"}], ":=", 
      RowBox[{"StringJoin", "@@", 
       RowBox[{"MapThread", "[", 
        RowBox[{"pick", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"List", "@@", "x"}], ",", 
           RowBox[{"List", "@@", "y"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pick", "[", 
       RowBox[{
        RowBox[{"x", ":", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "Alternatives"}], ")"}], "[", "__String", 
          "]"}]}], ",", 
        RowBox[{"y", ":", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "Alternatives"}], ")"}], "[", 
          RowBox[{"__", "?", "NumericQ"}], "]"}]}]}], "]"}], ":=", 
      RowBox[{"RandomChoice", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"List", "@@", "y"}], ")"}], "\[Rule]", 
        RowBox[{"(", 
         RowBox[{"List", "@@", "x"}], ")"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pick", "[", 
       RowBox[{
        RowBox[{"x", ":", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "Alternatives"}], ")"}], "[", "__", "]"}]}], ",", 
        RowBox[{"y", ":", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"_", ":", "Alternatives"}], ")"}], "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"_", "?", "NumericQ"}], ",", "_"}], "}"}], ".."}], 
          "]"}]}]}], "]"}], ":=", 
      RowBox[{"pick", "@@", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"First", "/@", 
           RowBox[{"List", "@@", "y"}]}], ")"}], "\[Rule]", 
         RowBox[{"(", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"List", "@@", "x"}], ",", 
             RowBox[{"Last", "/@", 
              RowBox[{"List", "@@", "y"}]}]}], "}"}], "]"}], ")"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pick", "[", 
       RowBox[{"x_String", ",", "_"}], "]"}], ":=", "x"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{"pick", "[", 
         RowBox[{"_", ",", "_"}], "]"}], ":=", 
        RowBox[{"Throw", "[", "Null", "]"}]}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Catch", "[", 
      RowBox[{"pick", "[", 
       RowBox[{
        RowBox[{"Syllable", "[", "context", "]"}], ",", 
        RowBox[{"SyllableProbabilities", "[", "context", "]"}]}], "]"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PossibleSyllables", "[", "context_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Syllable", "[", "context", "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"_String", "\[Rule]", "1"}], ",", 
     RowBox[{"StringExpression", "\[Rule]", "Times"}], ",", 
     RowBox[{"Alternatives", "\[Rule]", "Plus"}]}], "}"}]}]}]], "Input"]
}, Closed]],

Cell[CellGroupData[{

Cell["The Translator and Lexicon", "Subsubsection"],

Cell["\<\
The Translation expression stores expressions that translate English words. \
ApplyTranslation continues to translate until every string has been \
translated. \
\>", "Story"],

Cell[BoxData[
 RowBox[{"Clear", "[", 
  RowBox[{
  "Lexicon", ",", "ResetLexicon", ",", "EnterLexicon", ",", 
   "FantasyLanguages", ",", "RegisterLanguage", ",", "RequestedTerms", ",", 
   "RegisteredTerms", ",", "ApplyTranslation", ",", "Translation"}], 
  "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Translation", "[", 
    RowBox[{"s_String", ",", "language_"}], "]"}], ":=", "s"}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ApplyTranslation", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"form_", ",", "head_", ",", "body___List", ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ",", "language_"}], 
   "]"}], ":=", 
  RowBox[{"ReplaceRepeated", "[", 
   RowBox[{
    RowBox[{"Phrase", "[", 
     RowBox[{"form", ",", 
      RowBox[{"ApplyTranslation", "[", 
       RowBox[{"head", ",", "language"}], "]"}], ",", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ApplyTranslation", "[", 
           RowBox[{"#", ",", "language"}], "]"}], "&"}], ",", 
         RowBox[{"{", "body", "}"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ",", "opts"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"Phrase", "[", 
        RowBox[{"f_", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f_", ",", "h_", ",", 
           RowBox[{"arg1_List:", 
            RowBox[{"{", "}"}]}], ",", "mod1_List", ",", "o1___Rule"}], "]"}],
          ",", 
         RowBox[{"arg2_List:", 
          RowBox[{"{", "}"}]}], ",", "mod2_List", ",", "o2___Rule"}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{"Modify", "[", 
        RowBox[{"language", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f", ",", "h", ",", 
           RowBox[{"Join", "[", 
            RowBox[{"arg1", ",", "arg2"}], "]"}], ",", 
           RowBox[{"Join", "[", 
            RowBox[{"mod1", ",", "mod2"}], "]"}], ",", "o1"}], "]"}], ",", 
         "o2"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"Phrase", "[", 
        RowBox[{"f_", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f_", ",", "h_", ",", "o1___Rule"}], "]"}], ",", 
         "bod___List", ",", "o2___Rule"}], "]"}], "\[RuleDelayed]", 
       RowBox[{"Modify", "[", 
        RowBox[{"language", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f", ",", "h", ",", "bod", ",", "o1"}], "]"}], ",", "o2"}], 
        "]"}]}], ",", 
      RowBox[{
       RowBox[{"Phrase", "[", 
        RowBox[{"f_", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f_", ",", "h_", ",", "bod___List", ",", "o1___Rule"}], 
          "]"}], ",", "o2___Rule"}], "]"}], "\[RuleDelayed]", 
       RowBox[{"Modify", "[", 
        RowBox[{"language", ",", 
         RowBox[{"Phrase", "[", 
          RowBox[{"f", ",", "h", ",", "bod", ",", "o1"}], "]"}], ",", "o2"}], 
        "]"}]}]}], "}"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ApplyTranslation", "[", 
   RowBox[{"s_String", ",", "language_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"#", "=!=", "s"}], ",", 
      RowBox[{"ApplyTranslation", "[", 
       RowBox[{"#", ",", "language"}], "]"}], ",", "#"}], "]"}], "&"}], "[", 
   RowBox[{"Translation", "[", 
    RowBox[{"s", ",", "language"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ApplyTranslation", "[", 
    RowBox[{"Null", ",", "_"}], "]"}], "=", "Null"}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FantasyLanguages", "[", "]"}], "=", 
   RowBox[{"{", "}"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RegisterLanguage", "[", "language_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"FantasyLanguages", "[", "]"}], ",", "language"}], "]"}]}], 
      ",", 
      RowBox[{"AppendTo", "[", 
       RowBox[{
        RowBox[{"FantasyLanguages", "[", "]"}], ",", "language"}], "]"}]}], 
     "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"RegisteredTerms", "[", "language", "]"}], "=", 
     RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"RequestedTerms", "[", "language", "]"}], "=", 
     RowBox[{"{", "}"}]}], ";"}], ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Lexicon", "[", 
   RowBox[{"s_String", ",", "language_String"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"FilterRules", "[", 
        RowBox[{
         RowBox[{"DownValues", "[", "Translation", "]"}], ",", 
         RowBox[{"Verbatim", "[", 
          RowBox[{"HoldPattern", "[", 
           RowBox[{"Translation", "[", 
            RowBox[{"s", ",", "language"}], "]"}], "]"}], "]"}]}], "]"}], 
       "]"}], "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"RequestedTerms", "[", "language", "]"}], ",", "s"}], 
          "]"}], "]"}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{
          RowBox[{"RequestedTerms", "[", "language", "]"}], ",", "s"}], 
         "]"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"Lexicon", "[", 
        RowBox[{"s", ",", "language"}], "]"}], "=", 
       RowBox[{"\"\<$\>\"", "<>", "s", "<>", "\"\<$\>\""}]}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"RegisteredTerms", "[", "language", "]"}], ",", "s"}], 
          "]"}]}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{
          RowBox[{"RegisteredTerms", "[", "language", "]"}], ",", "s"}], 
         "]"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{"Lexicon", "[", 
        RowBox[{"s", ",", "language"}], "]"}], "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "#", "]"}], "===", "String"}], ",", "#", 
            ",", 
            RowBox[{
             RowBox[{"MorphemeJoiner", "[", "language", "]"}], "[", 
             RowBox[{"Flatten", "[", "#", "]"}], "]"}]}], "]"}], "&"}], "[", 
         RowBox[{"GeneratePhrase", "[", 
          RowBox[{
           RowBox[{"ApplyTranslation", "[", 
            RowBox[{"s", ",", "language"}], "]"}], ",", "language"}], "]"}], 
         "]"}], ")"}]}]}]}], "]"}], ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Lexicon", "[", 
   RowBox[{"s_String", ",", "language_String", ",", 
    RowBox[{"Capitalized", "\[Rule]", "True"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ToUpperCase", "[", 
      RowBox[{"StringTake", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "]"}], "<>", 
     RowBox[{"StringDrop", "[", 
      RowBox[{"#", ",", "1"}], "]"}]}], "&"}], "[", 
   RowBox[{"Lexicon", "[", 
    RowBox[{"s", ",", "language"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Lexicon", "[", 
   RowBox[{"s_String", ",", "language_String", ",", 
    RowBox[{"AllCapitalized", "\[Rule]", "True"}]}], "]"}], ":=", 
  RowBox[{"ToUpperCase", "[", 
   RowBox[{"Lexicon", "[", 
    RowBox[{"s", ",", "language"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResetLexicon", "[", "language_String", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"First", "/@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"DownValues", "[", "Lexicon", "]"}], ",", 
          RowBox[{"HoldPattern", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"g", ":", "HoldPattern"}], ")"}], "[", 
            RowBox[{"Lexicon", "[", 
             RowBox[{"_String", ",", "language"}], "]"}], "]"}], "]"}]}], 
         "]"}]}], ")"}], "/.", 
      RowBox[{"HoldPattern", "\[Rule]", "Unset"}]}], ";"}], ")"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EnterLexicon", "[", 
   RowBox[{"s_String", ",", "tr_", ",", "language_String"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Translation", "[", 
      RowBox[{"s", ",", "language"}], "]"}], "=", "tr"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Lexicon", "[", 
     RowBox[{"s", ",", "language"}], "]"}]}], ")"}]}]], "Input"]
}, Closed]]
}, Open  ]],

Cell["A Palette", "Subsection"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1157, 988},
WindowMargins->{{Automatic, 254}, {0, Automatic}},
PrintingPageRange->{Automatic, Automatic},
ShowSelection->True,
SpellingDictionaries->{"CorrectWords"->{
 "intuitionism", "intuistic", "falsificationism", "falsificationist", 
  "nominalism", "nominalistic", "disequilibrating", "evulotionism", 
  "scientistic", "verifyable", "foundationalism", "Falsificationism", 
  "Nominalism", "Essentialism", "essentialism", "knowlege", "Intuitionism", 
  "intuitionists", "manga", "anime", "online", "Luffy", "Strawhat", "Rango", 
  "Jonny", "Depp", "Canterlot", "forehoof", "Celestia", "Derpy", "altcoin", 
  "Mastercoin", "blockchain", "Mastercoins", "datastream", 
  "Willett\[CloseCurlyQuote]s", "mastercoins", "mastercoin", "altcoins"}},
Magnification:>1.25 Inherited,
FrontEndVersion->"9.0 for Linux x86 (64-bit) (February 7, 2013)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Title"], CellFrame -> {{0, 0}, {0, 1}}, 
       CellMargins -> {{27, Inherited}, {8, 34}}, TrackCellChangeTimes -> 
       False, FontFamily -> "OptimusPrinceps", FontSize -> 40, FontWeight -> 
       Plain], 
      Cell[
       StyleData["Title", "Printout"], CellFrame -> {{0, 0}, {1, 1}}, 
       CellMargins -> {{60, 60}, {22, 80}}, TextAlignment -> Center, FontSize -> 
       58]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Subtitle"], PageBreakBelow -> False, TrackCellChangeTimes -> 
       False, FontFamily -> "Hobbiton Brushhand", FontSize -> 24, FontWeight -> 
       "Plain", FontSlant -> "Plain", 
       FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}], 
      Cell[
       StyleData["Subtitle", "Printout"], PageBreakBelow -> False, 
       TextAlignment -> Center, FontSize -> 24]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Section"], CellFrame -> None, 
       CellMargins -> {{50, Inherited}, {8, 12}}, PageBreakAbove -> False, 
       PageBreakBelow -> False, DefaultNewInlineCellStyle -> "None", 
       TrackCellChangeTimes -> False, LanguageCategory -> "NaturalLanguage", 
       CounterIncrements -> "Section", 
       CounterAssignments -> {{"Subsection", 0}, {"Subsubsection", 0}, {
         "Item", 0}, {"Subitem", 0}, {"Subsubitem", 0}, {"ItemNumbered", 0}, {
         "SubitemNumbered", 0}, {"SubsubitemNumbered", 0}, {"Equation", 0}}, 
       FontFamily -> "Cloister Black", FontSize -> 36, FontWeight -> "Plain", 
       FontSlant -> "Plain", 
       FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}], 
      Cell[
       StyleData["Section", "Printout"], CellMargins -> {{2, 0}, {0, 22}}, 
       PageBreakAbove -> False, FontFamily -> "Garamond", FontSize -> 20]}, 
     Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Subsection"], CellDingbat -> None, 
       CellMargins -> {{75, 40}, {10, 22}}, TrackCellChangeTimes -> False, 
       CounterAssignments -> {{"Subsubsubsection", 0}, {"Subsubsection", 0}, {
         "Item", 0}, {"Subitem", 0}, {"Subsubitem", 0}, {"ItemNumbered", 0}, {
         "SubitemNumbered", 0}, {"SubsubitemNumbered", 0}}, FontFamily -> 
       "Vivaldi", FontSize -> 20, FontWeight -> "Plain", FontSlant -> 
       "Italic", 
       FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}], 
      Cell[
       StyleData["Subsection", "Printout"], CellMargins -> {{2, 0}, {10, 16}},
        TrackCellChangeTimes -> False, FontFamily -> "Garamond", FontSize -> 
       20, FontSlant -> Plain]}, Closed]], 
   Cell[
    StyleData["Subsection Deleted"], CellDingbat -> None, 
    CellMargins -> {{75, 40}, {10, 22}}, 
    CellGroupingRules -> {"SectionGrouping", 40}, TrackCellChangeTimes -> 
    False, CounterIncrements -> "Subsection", FontFamily -> "Magneto", 
    FontSize -> 20, FontWeight -> "Plain", FontSlant -> "Italic", 
    FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Subsubsection"], CellDingbat -> \[FivePointedStar], 
       CellMargins -> {{115, 40}, {10, 22}}, TrackCellChangeTimes -> False, 
       CounterAssignments -> {{"Subsubsubsection", 0}, {"Item", 0}, {
         "Subitem", 0}, {"Subsubitem", 0}, {"ItemNumbered", 0}, {
         "SubitemNumbered", 0}, {"SubsubitemNumbered", 0}, {
         "Definition", 0}, {"Proposition", 0}, {"Figure", 0}, {
         "DisplayFormula", 0}, {"DisplayFormulaNumbered", 0}}, FontFamily -> 
       "Zenda", FontSize -> 16, FontWeight -> "Bold", 
       FontVariations -> {"StrikeThrough" -> False, "Underline" -> False}], 
      Cell[
       StyleData["Subsubsection", "Printout"], CellDingbat -> None, 
       CellMargins -> {{2, 0}, {10, 16}}, FontFamily -> "Garamond"]}, 
     Closed]], 
   Cell[
    StyleData["Subsubsubsection"], CellMargins -> {{120, Inherited}, {2, 10}},
     StyleKeyMapping -> {
     "Tab" -> "Subsubsubsubsection", "Backspace" -> "Subsubsection", 
      KeyEvent["Tab", Modifiers -> {Shift}] -> "Subsubsection"}, 
    CellGroupingRules -> {"SectionGrouping", 60}, PageBreakBelow -> False, 
    TrackCellChangeTimes -> False, LanguageCategory -> "NaturalLanguage", 
    CounterIncrements -> "Subsubsubsection", 
    CounterAssignments -> {{"Subsubsubsubsection", 0}, {"Item", 0}, {
      "Subitem", 0}, {"Subsubitem", 0}, {"ItemNumbered", 0}, {
      "SubitemNumbered", 0}, {"SubsubitemNumbered", 0}}, MenuSortingValue -> 
    None, FontFamily -> "Arial", FontSize -> 14, FontWeight -> "Bold", 
    FontColor -> 
    RGBColor[0.778286411841001, 0.4230563820859083, 0.16115053025101092`]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Text"], CellMargins -> {{90, 160}, {10, 10}}, 
       TrackCellChangeTimes -> False, TextJustification -> 1, 
       ParagraphIndent -> -36], 
      Cell[
       StyleData["Text", "Printout"], CellOpen -> False]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Paragraph"], CellMargins -> {{120, 200}, {10, 10}}, 
       ReturnCreatesNewCell -> True, CellLabelAutoDelete -> False, 
       TrackCellChangeTimes -> False, TextJustification -> 1, 
       LineSpacing -> {1, 3}, CounterIncrements -> "Text", FontFamily -> 
       "Garamond", FontSize -> 14], 
      Cell[
       StyleData["Paragraph", "Printout"], 
       CellMargins -> {{36, 140}, {12, 12}}, LineSpacing -> {1, 7}, 
       ParagraphIndent -> 0, FontFamily -> "Georgia", FontSize -> 14]}, 
     Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["LibrettoLyrics"], CellMargins -> {{120, 200}, {10, 10}}, 
       CellLabelAutoDelete -> False, TrackCellChangeTimes -> False, 
       TextJustification -> 0, LineSpacing -> {1, 3}, CounterIncrements -> 
       "Text", FontFamily -> "Garamond", FontSize -> 14], 
      Cell[
       StyleData["LibrettoLyrics", "Printout"], 
       CellMargins -> {{36, 140}, {12, 12}}, LineSpacing -> {1, 7}, 
       ParagraphIndent -> 0, FontFamily -> "Georgia", FontSize -> 14]}, 
     Open]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["LibrettoDirections"], CellMargins -> {{120, 200}, {10, 10}},
        ReturnCreatesNewCell -> True, CellLabelAutoDelete -> False, 
       TrackCellChangeTimes -> False, TextJustification -> 1, 
       LineSpacing -> {1, 3}, CounterIncrements -> "Text", FontFamily -> 
       "Garamond", FontSize -> 14, FontSlant -> Italic], 
      Cell[
       StyleData["LibrettoDirections", "Printout"], 
       CellMargins -> {{36, 140}, {12, 12}}, LineSpacing -> {1, 7}, 
       ParagraphIndent -> 0, FontFamily -> "Georgia", FontSize -> 14]}, 
     Open]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Footnote"], CellMargins -> {{120, 200}, {10, 10}}, 
       ReturnCreatesNewCell -> True, TrackCellChangeTimes -> False, 
       TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
       "Text", FontFamily -> "Garamond", FontSize -> 11], 
      Cell[
       StyleData["Footnote", "Printout"], CellMargins -> {{72, 140}, {4, 4}}, 
       LineSpacing -> {1, 3}, FontSize -> 15]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["ContinuedParagraph"], CellMargins -> {{120, 200}, {10, 10}},
        ReturnCreatesNewCell -> False, TrackCellChangeTimes -> False, 
       TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
       "Text", FontFamily -> "Garamond", FontSize -> 14], 
      Cell[
       StyleData["ContinuedParagraph", "Printout"], 
       CellMargins -> {{72, 140}, {4, 4}}, LineSpacing -> {1, 3}, 
       ParagraphIndent -> 0, FontSize -> 15]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Quote"], CellMargins -> {{140, 220}, {10, 10}}, 
       ReturnCreatesNewCell -> True, TrackCellChangeTimes -> False, 
       TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
       "Text", FontFamily -> "Garamond", FontSize -> 14, FontSlant -> 1], 
      Cell[
       StyleData["Quote", "Printout"], CellMargins -> {{92, 160}, {4, 4}}, 
       LineSpacing -> {1, 3}, ParagraphIndent -> 16, FontSize -> 15, 
       FontSlant -> Plain]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Reference"], CellMargins -> {{120, 200}, {10, 10}}, 
       ReturnCreatesNewCell -> True, TrackCellChangeTimes -> False, 
       TextJustification -> 1, LineSpacing -> {1, 3}, ParagraphIndent -> -20, 
       CounterIncrements -> "Text", FontFamily -> "Garamond", FontSize -> 14], 
      Cell[
       StyleData["Reference", "Printout"], CellMargins -> {{72, 140}, {4, 4}},
        LineSpacing -> {1, 3}, FontSize -> 15]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Header"], FontFamily -> "Verdana", FontSize -> 10, 
       FontSlant -> "Plain"], 
      Cell[
       StyleData["Header", "Printout"], Magnification -> 1.]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["PageNumber"], FontFamily -> "Champagne", FontSize -> 10, 
       FontWeight -> "Plain"], 
      Cell[
       StyleData["PageNumber", "Printout"], FontSize -> 15]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Item"], CellDingbat -> 
       Cell["\[FilledSmallCircle]", FontWeight -> "Bold"], 
       CellMargins -> {{135, 200}, {4, 4}}, ReturnCreatesNewCell -> True, 
       CellGroupingRules -> {"GroupTogetherNestedGrouping", 15000}, 
       CellFrameLabelMargins -> 4, TrackCellChangeTimes -> False, 
       TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
       "Item", CounterAssignments -> {{"Subitem", 0}, {"Subsubitem", 0}}, 
       MenuSortingValue -> 1600, FontFamily -> "Garamond", FontSize -> 14], 
      Cell[
       StyleData["Item", "Presentation"], CellMargins -> {{100, 10}, {7, 7}}, 
       CellFrameLabelMargins -> 6, FontSize -> 24], 
      Cell[
       StyleData["Item", "Condensed"], 
       CellMargins -> {{58, Inherited}, {2, 2}}, FontSize -> 8], 
      Cell[
       StyleData["Item", "Printout"], CellMargins -> {{96, 150}, {4, 4}}]}, 
     Closed]], 
   Cell[
    StyleData["Subitem"], CellMargins -> {{155, 200}, {4, 4}}, 
    ReturnCreatesNewCell -> True, 
    CellGroupingRules -> {"GroupTogetherNestedGrouping", 15000}, 
    CellFrameLabelMargins -> 4, TrackCellChangeTimes -> False, 
    TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
    "Item", CounterAssignments -> {{"Subitem", 0}, {"Subsubitem", 0}}, 
    MenuSortingValue -> 1600, FontFamily -> "Garamond", FontSize -> 12], 
   Cell[
    StyleData["Subsubitem"], CellDingbat -> "\[Diamond]", 
    CellMargins -> {{165, 200}, {4, 4}}, ReturnCreatesNewCell -> True, 
    CellGroupingRules -> {"GroupTogetherNestedGrouping", 15000}, 
    CellFrameLabelMargins -> 4, TrackCellChangeTimes -> False, 
    TextJustification -> 1, LineSpacing -> {1, 3}, CounterIncrements -> 
    "Item", CounterAssignments -> {{"Subitem", 0}, {"Subsubitem", 0}}, 
    MenuSortingValue -> 1600, FontFamily -> "Garamond", FontSize -> 12], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Image Label"], CellMargins -> {{132, 192}, {10, 10}}, 
       ReturnCreatesNewCell -> True, TrackCellChangeTimes -> False, 
       TextAlignment -> Center, TextJustification -> 0, LineSpacing -> {1, 3},
        CounterIncrements -> "Text", FontFamily -> "Garamond", FontSize -> 
       14], 
      Cell[
       StyleData["Paragraph", "Printout"], CellMargins -> {{72, 140}, {4, 4}},
        LineSpacing -> {1, 3}, ParagraphIndent -> 16, FontSize -> 15]}, 
     Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["InlineFormula"], CellMargins -> {{10, 4}, {0, 8}}, 
       StripStyleOnPaste -> True, 
       HyphenationOptions -> {"HyphenationCharacter" -> "\[Continuation]"}, 
       LanguageCategory -> "Formula", ScriptLevel -> 1, SingleLetterItalics -> 
       True, MenuSortingValue -> 1650, FontFamily -> "Garamond"], 
      Cell[
       StyleData["InlineFormula", "Printout"], 
       CellMargins -> {{2, 0}, {6, 6}}]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["DisplayFormula"], 
       CellMargins -> {{150, Inherited}, {Inherited, Inherited}}, 
       StripStyleOnPaste -> True, DefaultFormatType -> TraditionalForm, 
       TrackCellChangeTimes -> False, 
       HyphenationOptions -> {"HyphenationCharacter" -> "\[Continuation]"}, 
       LanguageCategory -> "Formula", ScriptLevel -> 0, SingleLetterItalics -> 
       True, MenuSortingValue -> 1700, FontFamily -> "Garamond", 
       UnderoverscriptBoxOptions -> {LimitsPositioning -> True}], 
      Cell[
       StyleData["DisplayFormula", "Printout"], 
       CellMargins -> {{52, 115}, {12, 12}}, PageBreakWithin -> False, 
       TextAlignment -> Center, FontSize -> 15]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["DisplayFormulaNumbered"], 
       CellMargins -> {{150, Inherited}, {Inherited, Inherited}}, 
       StripStyleOnPaste -> True, CellFrameLabels -> {{None, 
          Cell[
           TextData[{"(", 
             CounterBox["Subsubsection"], ", ", 
             CounterBox["DisplayFormulaNumbered"], ")"}], 
           "DisplayFormulaEquationNumber"]}, {None, None}}, DefaultFormatType -> 
       TraditionalForm, TrackCellChangeTimes -> False, 
       HyphenationOptions -> {"HyphenationCharacter" -> "\[Continuation]"}, 
       LanguageCategory -> "Formula", ScriptLevel -> 0, SingleLetterItalics -> 
       True, CounterIncrements -> "DisplayFormulaNumbered", MenuSortingValue -> 
       1710, FontFamily -> "Garamond", 
       UnderoverscriptBoxOptions -> {LimitsPositioning -> True}], 
      Cell[
       StyleData["DisplayFormulaNumbered", "Printout"], 
       CellMargins -> {{52, 115}, {12, 12}}, PageBreakWithin -> False, 
       TextAlignment -> Center, FontSize -> 15]}, Closed]], 
   Cell[
    StyleData["DisplayFormulaEquationNumber"], FontFamily -> "Times", 
    FontSize -> -1 + Inherited], 
   Cell[
    StyleData["MarginalNote"], CellMargins -> {{5, 0}, {0, 0}}, FontFamily -> 
    "Times New Roman", FontSize -> 12], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Input"], TrackCellChangeTimes -> False, FontSize -> 13], 
      Cell[
       StyleData["Input", "Presentation"], 
       CellMargins -> {{100, 10}, {8, 15}}], 
      Cell[
       StyleData["Input", "SlideShow"], 
       CellMargins -> {{
         0.135 FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}], 0.01 
          FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}]}, {8, 15}}, 
       LinebreakAdjustments -> {1, 2., 12., 1., 1.}, FontSize -> 20], 
      Cell[
       StyleData["Input", "Condensed"], CellMargins -> {{50, 10}, {2, 3}}], 
      Cell[
       StyleData["Input", "Printout"], 
       CellMargins -> {{49, Inherited}, {Inherited, 8}}, 
       LinebreakAdjustments -> {0.85, 2, 10, 1, 1}], 
      Cell[
       StyleData["Input", "PrintoutGray"], 
       CellMargins -> {{49, Inherited}, {Inherited, 8}}, 
       LinebreakAdjustments -> {0.85, 2, 10, 1, 1}]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Output"], TrackCellChangeTimes -> False, FontSize -> 13], 
      Cell[
       StyleData["Output", "Presentation"], 
       CellMargins -> {{100, 10}, {15, 8}}], 
      Cell[
       StyleData["Output", "SlideShow"], 
       CellMargins -> {{
         0.135 FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}], 0.01 
          FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}]}, {15, 8}}, 
       LinebreakAdjustments -> {1, 2., 12., 1., 1.}, FontSize -> 20], 
      Cell[
       StyleData["Output", "Condensed"], 
       CellMargins -> {{50, Inherited}, {3, 2}}], 
      Cell[
       StyleData["Output", "Printout"], 
       CellMargins -> {{49, Inherited}, {9, 3}}], 
      Cell[
       StyleData["Output", "PrintoutGray"], 
       CellMargins -> {{49, Inherited}, {9, 3}}]}, Closed]], 
   Cell[
    CellGroupData[{
      Cell[
       StyleData["Message"], TrackCellChangeTimes -> False], 
      Cell[
       StyleData["Message", "Presentation"], 
       CellMargins -> {{100, Inherited}, {1.5 Inherited, 1.5 Inherited}}], 
      Cell[
       StyleData["Message", "SlideShow"], 
       CellMargins -> {{
         0.135 FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}], 0.01 
          FrontEnd`AbsoluteCurrentValue[{WindowSize, 1}]}, {8, 15}}, FontSize -> 
       18], 
      Cell[
       StyleData["Message", "Condensed"], 
       CellMargins -> {{18, Inherited}, {Inherited, Inherited}}], 
      Cell[
       StyleData["Message", "Printout"], 
       CellMargins -> {{49, Inherited}, {Inherited, Inherited}}, 
       CellFrameLabels -> {{None, None}, {None, None}}], 
      Cell[
       StyleData["Message", "PrintoutGray"], 
       CellMargins -> {{49, Inherited}, {Inherited, Inherited}}, 
       CellFrameLabels -> {{None, None}, {None, None}}, FontColor -> 
       GrayLevel[0.5]]}, Closed]]}, Visible -> False, FrontEndVersion -> 
  "9.0 for Linux x86 (64-bit) (February 7, 2013)", StyleDefinitions -> 
  "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 27, 0, 123, "Title"],
Cell[CellGroupData[{
Cell[631, 26, 103, 4, 78, "Section"],
Cell[CellGroupData[{
Cell[759, 34, 41, 0, 88, "Subsection"],
Cell[803, 36, 83, 1, 58, "Paragraph"],
Cell[889, 39, 513, 13, 111, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1439, 57, 41, 0, 88, "Subsection"],
Cell[1483, 59, 97, 2, 58, "Paragraph"],
Cell[1583, 63, 729, 19, 173, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2349, 87, 61, 1, 88, "Subsection"],
Cell[2413, 90, 138, 3, 91, "Paragraph"],
Cell[2554, 95, 184, 3, 91, "Paragraph"],
Cell[2741, 100, 641, 15, 173, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[3431, 121, 39, 0, 67, "Section"],
Cell[CellGroupData[{
Cell[3495, 125, 27, 0, 88, "Subsection"],
Cell[3525, 127, 129, 3, 91, "Paragraph"],
Cell[CellGroupData[{
Cell[3679, 134, 60, 0, 40, "Item"],
Cell[3742, 136, 63, 0, 40, "Item"]
}, Open  ]],
Cell[3820, 139, 146, 3, 91, "Paragraph"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4003, 147, 31, 0, 88, "Subsection"],
Cell[4037, 149, 48, 0, 81, "Subsubsection"]
}, Open  ]]
}, Closed]],
Cell[4112, 153, 28, 0, 67, "Section"],
Cell[CellGroupData[{
Cell[4165, 157, 30, 0, 67, "Section"],
Cell[4198, 159, 674, 13, 97, "Input"],
Cell[4875, 174, 1684, 44, 171, "Input"],
Cell[6562, 220, 2020, 55, 197, "Input"],
Cell[8585, 277, 2745, 69, 301, "Input"],
Cell[11333, 348, 3188, 81, 275, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[14558, 434, 39, 0, 67, "Section"],
Cell[14600, 436, 952, 25, 89, "Input"],
Cell[15555, 463, 72, 1, 38, "Input"],
Cell[15630, 466, 145, 4, 38, "Input"],
Cell[15778, 472, 277, 8, 38, "Input"],
Cell[16058, 482, 1182, 25, 114, "Input"],
Cell[17243, 509, 610, 19, 89, "Input"],
Cell[17856, 530, 34034, 710, 3114, "Input"],
Cell[51893, 1242, 1055, 30, 164, "Input"],
Cell[52951, 1274, 141, 2, 38, "Input"],
Cell[53095, 1278, 393, 10, 38, "Input"],
Cell[53491, 1290, 7248, 178, 639, "Input"],
Cell[60742, 1470, 4285, 106, 389, "Input"],
Cell[65030, 1578, 3927, 95, 364, "Input"],
Cell[68960, 1675, 1612, 44, 189, "Input"],
Cell[70575, 1721, 2106, 57, 214, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[72730, 1784, 51, 0, 123, "Title"],
Cell[CellGroupData[{
Cell[72806, 1788, 24, 0, 135, "Section"],
Cell[CellGroupData[{
Cell[72855, 1792, 37, 0, 135, "Subsection"],
Cell[72895, 1794, 156, 3, 135, "Paragraph"],
Cell[73054, 1799, 65, 0, 135, "Paragraph"],
Cell[CellGroupData[{
Cell[73144, 1803, 119, 3, 135, "Item"],
Cell[73266, 1808, 132, 3, 135, "Subitem"],
Cell[73401, 1813, 45, 0, 135, "Subsubitem"],
Cell[73449, 1815, 55, 0, 135, "Subsubitem"],
Cell[73507, 1817, 74, 2, 135, "Subsubitem"],
Cell[73584, 1821, 77, 2, 135, "Subitem"],
Cell[73664, 1825, 78, 2, 135, "Subitem"],
Cell[73745, 1829, 85, 2, 135, "Subsubitem"],
Cell[73833, 1833, 60, 0, 135, "Subsubitem"],
Cell[73896, 1835, 29, 0, 135, "Item"],
Cell[73928, 1837, 31, 0, 135, "Item"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[74008, 1843, 34, 0, 135, "Subsection"],
Cell[74045, 1845, 404, 6, 135, "Paragraph"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[74510, 1858, 43, 0, 85, "Title"],
Cell[CellGroupData[{
Cell[74578, 1862, 39, 0, 78, "Section"],
Cell[CellGroupData[{
Cell[74642, 1866, 40, 0, 71, "Subsection"],
Cell[CellGroupData[{
Cell[74707, 1870, 40, 0, 65, "Subsubsection"],
Cell[74750, 1872, 130, 3, 135, "Text"],
Cell[74883, 1877, 1896, 40, 135, "Input"],
Cell[76782, 1919, 193, 4, 135, "Input"],
Cell[76978, 1925, 5740, 164, 135, "Input"],
Cell[82721, 2091, 239, 7, 135, "Input"],
Cell[82963, 2100, 810, 23, 135, "Input"],
Cell[83776, 2125, 151, 4, 135, "Input"],
Cell[83930, 2131, 2028, 56, 135, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[85995, 2192, 59, 0, 41, "Subsubsection"],
Cell[86057, 2194, 193, 5, 135, "Input"],
Cell[86253, 2201, 54, 0, 135, "Paragraph"],
Cell[86310, 2203, 293, 9, 135, "Input"],
Cell[86606, 2214, 728, 21, 135, "Input"],
Cell[87337, 2237, 2878, 72, 135, "Input"],
Cell[90218, 2311, 52, 0, 135, "Paragraph"],
Cell[90273, 2313, 1793, 50, 135, "Input"],
Cell[92069, 2365, 304, 8, 135, "Input"],
Cell[92376, 2375, 114, 3, 135, "Input"],
Cell[92493, 2380, 95, 2, 135, "Paragraph"],
Cell[92591, 2384, 9849, 252, 135, "Input"],
Cell[102443, 2638, 158, 3, 135, "Paragraph"],
Cell[102604, 2643, 71, 1, 135, "Input"],
Cell[102678, 2646, 602, 17, 135, "Input"],
Cell[103283, 2665, 479, 13, 135, "Input"],
Cell[103765, 2680, 224, 7, 135, "Input"],
Cell[103992, 2689, 2722, 70, 135, "Input"],
Cell[106717, 2761, 126, 3, 135, "Paragraph"],
Cell[106846, 2766, 265, 9, 135, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[107148, 2780, 42, 0, 41, "Subsubsection"],
Cell[107193, 2782, 121, 3, 135, "Input"],
Cell[107317, 2787, 408, 12, 135, "Input"],
Cell[107728, 2801, 1637, 43, 135, "Input"],
Cell[109368, 2846, 3372, 97, 135, "Input"],
Cell[112743, 2945, 361, 9, 135, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[113141, 2959, 51, 0, 41, "Subsubsection"],
Cell[113195, 2961, 185, 4, 135, "Story"],
Cell[113383, 2967, 275, 6, 135, "Input"],
Cell[113661, 2975, 150, 5, 135, "Input"],
Cell[113814, 2982, 2524, 66, 135, "Input"],
Cell[116341, 3050, 428, 12, 135, "Input"],
Cell[116772, 3064, 142, 4, 135, "Input"],
Cell[116917, 3070, 125, 4, 135, "Input"],
Cell[117045, 3076, 734, 21, 135, "Input"],
Cell[117782, 3099, 2266, 64, 135, "Input"],
Cell[120051, 3165, 500, 14, 135, "Input"],
Cell[120554, 3181, 291, 7, 135, "Input"],
Cell[120848, 3190, 689, 20, 135, "Input"],
Cell[121540, 3212, 391, 11, 135, "Input"]
}, Closed]]
}, Open  ]],
Cell[121958, 3227, 31, 0, 71, "Subsection"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
